{"version":3,"file":"support.js","sources":["src/support/check.js","node_modules/core-js/modules/es6.string.starts-with.js","node_modules/core-js/modules/es6.string.from-code-point.js","node_modules/core-js/modules/es6.array.from.js","node_modules/core-js/modules/es6.promise.js","node_modules/core-js/modules/es6.symbol.js","src/support/polyfill.js","node_modules/regenerator-runtime/runtime.js","src/polyfill.js","src/lib/event.js","src/lib/copier.js","src/buttons.js","node_modules/ok-emoji/src/string.js","node_modules/ok-emoji/src/emoji.js","node_modules/ok-emoji/src/measurer.js","src/lib/modifier.js","src/lib/cache.js","src/lib/word.js","src/input.js","src/lib/promises.js","src/lib/results.js","src/lib/type.js","src/lib/provider.js","src/lib/prefixgen.js","src/lib/worker.js","src/lib/valid.js","src/options.js","src/selection.js","src/page.js","src/adverts.js","src/sw.js","src/offline.js","src/placeholders.js","src/bundle.js"],"sourcesContent":["\nif (!window.location.search || window.location.search.indexOf('ignore_check') === -1) {\n  const support = true && window.Map && window.WeakMap;\n  if (!support) {\n    window.location = 'error.html';\n  }\n}\n","// 21.1.3.18 String.prototype.startsWith(searchString [, position ])\n'use strict';\nvar $export = require('./_export');\nvar toLength = require('./_to-length');\nvar context = require('./_string-context');\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n$export($export.P + $export.F * require('./_fails-is-regexp')(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = context(this, searchString, STARTS_WITH);\n    var index = toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n","var $export = require('./_export');\nvar toAbsoluteIndex = require('./_to-absolute-index');\nvar fromCharCode = String.fromCharCode;\nvar $fromCodePoint = String.fromCodePoint;\n\n// length should be 1, old FF problem\n$export($export.S + $export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {\n  // 21.1.2.2 String.fromCodePoint(...codePoints)\n  fromCodePoint: function fromCodePoint(x) { // eslint-disable-line no-unused-vars\n    var res = [];\n    var aLen = arguments.length;\n    var i = 0;\n    var code;\n    while (aLen > i) {\n      code = +arguments[i++];\n      if (toAbsoluteIndex(code, 0x10ffff) !== code) throw RangeError(code + ' is not a valid code point');\n      res.push(code < 0x10000\n        ? fromCharCode(code)\n        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)\n      );\n    } return res.join('');\n  }\n});\n","'use strict';\nvar ctx = require('./_ctx');\nvar $export = require('./_export');\nvar toObject = require('./_to-object');\nvar call = require('./_iter-call');\nvar isArrayIter = require('./_is-array-iter');\nvar toLength = require('./_to-length');\nvar createProperty = require('./_create-property');\nvar getIterFn = require('./core.get-iterator-method');\n\n$export($export.S + $export.F * !require('./_iter-detect')(function (iter) { Array.from(iter); }), 'Array', {\n  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)\n  from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {\n    var O = toObject(arrayLike);\n    var C = typeof this == 'function' ? this : Array;\n    var aLen = arguments.length;\n    var mapfn = aLen > 1 ? arguments[1] : undefined;\n    var mapping = mapfn !== undefined;\n    var index = 0;\n    var iterFn = getIterFn(O);\n    var length, result, step, iterator;\n    if (mapping) mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);\n    // if object isn't iterable or it's array with default iterator - use simple case\n    if (iterFn != undefined && !(C == Array && isArrayIter(iterFn))) {\n      for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {\n        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);\n      }\n    } else {\n      length = toLength(O.length);\n      for (result = new C(length); length > index; index++) {\n        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);\n      }\n    }\n    result.length = index;\n    return result;\n  }\n});\n","'use strict';\nvar LIBRARY = require('./_library');\nvar global = require('./_global');\nvar ctx = require('./_ctx');\nvar classof = require('./_classof');\nvar $export = require('./_export');\nvar isObject = require('./_is-object');\nvar aFunction = require('./_a-function');\nvar anInstance = require('./_an-instance');\nvar forOf = require('./_for-of');\nvar speciesConstructor = require('./_species-constructor');\nvar task = require('./_task').set;\nvar microtask = require('./_microtask')();\nvar newPromiseCapabilityModule = require('./_new-promise-capability');\nvar perform = require('./_perform');\nvar userAgent = require('./_user-agent');\nvar promiseResolve = require('./_promise-resolve');\nvar PROMISE = 'Promise';\nvar TypeError = global.TypeError;\nvar process = global.process;\nvar versions = process && process.versions;\nvar v8 = versions && versions.v8 || '';\nvar $Promise = global[PROMISE];\nvar isNode = classof(process) == 'process';\nvar empty = function () { /* empty */ };\nvar Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;\nvar newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;\n\nvar USE_NATIVE = !!function () {\n  try {\n    // correct subclassing with @@species support\n    var promise = $Promise.resolve(1);\n    var FakePromise = (promise.constructor = {})[require('./_wks')('species')] = function (exec) {\n      exec(empty, empty);\n    };\n    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    return (isNode || typeof PromiseRejectionEvent == 'function')\n      && promise.then(empty) instanceof FakePromise\n      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n      // we can't detect it synchronously, so just check versions\n      && v8.indexOf('6.6') !== 0\n      && userAgent.indexOf('Chrome/66') === -1;\n  } catch (e) { /* empty */ }\n}();\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar notify = function (promise, isReject) {\n  if (promise._n) return;\n  promise._n = true;\n  var chain = promise._c;\n  microtask(function () {\n    var value = promise._v;\n    var ok = promise._s == 1;\n    var i = 0;\n    var run = function (reaction) {\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (promise._h == 2) onHandleUnhandled(promise);\n            promise._h = 1;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // may throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (e) {\n        if (domain && !exited) domain.exit();\n        reject(e);\n      }\n    };\n    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach\n    promise._c = [];\n    promise._n = false;\n    if (isReject && !promise._h) onUnhandled(promise);\n  });\n};\nvar onUnhandled = function (promise) {\n  task.call(global, function () {\n    var value = promise._v;\n    var unhandled = isUnhandled(promise);\n    var result, handler, console;\n    if (unhandled) {\n      result = perform(function () {\n        if (isNode) {\n          process.emit('unhandledRejection', value, promise);\n        } else if (handler = global.onunhandledrejection) {\n          handler({ promise: promise, reason: value });\n        } else if ((console = global.console) && console.error) {\n          console.error('Unhandled promise rejection', value);\n        }\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      promise._h = isNode || isUnhandled(promise) ? 2 : 1;\n    } promise._a = undefined;\n    if (unhandled && result.e) throw result.v;\n  });\n};\nvar isUnhandled = function (promise) {\n  return promise._h !== 1 && (promise._a || promise._c).length === 0;\n};\nvar onHandleUnhandled = function (promise) {\n  task.call(global, function () {\n    var handler;\n    if (isNode) {\n      process.emit('rejectionHandled', promise);\n    } else if (handler = global.onrejectionhandled) {\n      handler({ promise: promise, reason: promise._v });\n    }\n  });\n};\nvar $reject = function (value) {\n  var promise = this;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  promise._v = value;\n  promise._s = 2;\n  if (!promise._a) promise._a = promise._c.slice();\n  notify(promise, true);\n};\nvar $resolve = function (value) {\n  var promise = this;\n  var then;\n  if (promise._d) return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  try {\n    if (promise === value) throw TypeError(\"Promise can't be resolved itself\");\n    if (then = isThenable(value)) {\n      microtask(function () {\n        var wrapper = { _w: promise, _d: false }; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch (e) {\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      promise._v = value;\n      promise._s = 1;\n      notify(promise, false);\n    }\n  } catch (e) {\n    $reject.call({ _w: promise, _d: false }, e); // wrap\n  }\n};\n\n// constructor polyfill\nif (!USE_NATIVE) {\n  // 25.4.3.1 Promise(executor)\n  $Promise = function Promise(executor) {\n    anInstance(this, $Promise, PROMISE, '_h');\n    aFunction(executor);\n    Internal.call(this);\n    try {\n      executor(ctx($resolve, this, 1), ctx($reject, this, 1));\n    } catch (err) {\n      $reject.call(this, err);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    this._c = [];             // <- awaiting reactions\n    this._a = undefined;      // <- checked in isUnhandled reactions\n    this._s = 0;              // <- state\n    this._d = false;          // <- done\n    this._v = undefined;      // <- value\n    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled\n    this._n = false;          // <- notify\n  };\n  Internal.prototype = require('./_redefine-all')($Promise.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected) {\n      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = isNode ? process.domain : undefined;\n      this._c.push(reaction);\n      if (this._a) this._a.push(reaction);\n      if (this._s) notify(this, false);\n      return reaction.promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    this.promise = promise;\n    this.resolve = ctx($resolve, promise, 1);\n    this.reject = ctx($reject, promise, 1);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === $Promise || C === Wrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });\nrequire('./_set-to-string-tag')($Promise, PROMISE);\nrequire('./_set-species')(PROMISE);\nWrapper = require('./_core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    var $$reject = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x) {\n    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./_iter-detect')(function (iter) {\n  $Promise.all(iter)['catch'](empty);\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var values = [];\n      var index = 0;\n      var remaining = 1;\n      forOf(iterable, false, function (promise) {\n        var $index = index++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        C.resolve(promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[$index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      forOf(iterable, false, function (promise) {\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.e) reject(result.v);\n    return capability.promise;\n  }\n});\n","'use strict';\n// ECMAScript 6 symbols shim\nvar global = require('./_global');\nvar has = require('./_has');\nvar DESCRIPTORS = require('./_descriptors');\nvar $export = require('./_export');\nvar redefine = require('./_redefine');\nvar META = require('./_meta').KEY;\nvar $fails = require('./_fails');\nvar shared = require('./_shared');\nvar setToStringTag = require('./_set-to-string-tag');\nvar uid = require('./_uid');\nvar wks = require('./_wks');\nvar wksExt = require('./_wks-ext');\nvar wksDefine = require('./_wks-define');\nvar enumKeys = require('./_enum-keys');\nvar isArray = require('./_is-array');\nvar anObject = require('./_an-object');\nvar isObject = require('./_is-object');\nvar toIObject = require('./_to-iobject');\nvar toPrimitive = require('./_to-primitive');\nvar createDesc = require('./_property-desc');\nvar _create = require('./_object-create');\nvar gOPNExt = require('./_object-gopn-ext');\nvar $GOPD = require('./_object-gopd');\nvar $DP = require('./_object-dp');\nvar $keys = require('./_object-keys');\nvar gOPD = $GOPD.f;\nvar dP = $DP.f;\nvar gOPN = gOPNExt.f;\nvar $Symbol = global.Symbol;\nvar $JSON = global.JSON;\nvar _stringify = $JSON && $JSON.stringify;\nvar PROTOTYPE = 'prototype';\nvar HIDDEN = wks('_hidden');\nvar TO_PRIMITIVE = wks('toPrimitive');\nvar isEnum = {}.propertyIsEnumerable;\nvar SymbolRegistry = shared('symbol-registry');\nvar AllSymbols = shared('symbols');\nvar OPSymbols = shared('op-symbols');\nvar ObjectProto = Object[PROTOTYPE];\nvar USE_NATIVE = typeof $Symbol == 'function';\nvar QObject = global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = DESCRIPTORS && $fails(function () {\n  return _create(dP({}, 'a', {\n    get: function () { return dP(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (it, key, D) {\n  var protoDesc = gOPD(ObjectProto, key);\n  if (protoDesc) delete ObjectProto[key];\n  dP(it, key, D);\n  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);\n} : dP;\n\nvar wrap = function (tag) {\n  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D) {\n  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);\n  anObject(it);\n  key = toPrimitive(key, true);\n  anObject(D);\n  if (has(AllSymbols, key)) {\n    if (!D.enumerable) {\n      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;\n      D = _create(D, { enumerable: createDesc(0, false) });\n    } return setSymbolDesc(it, key, D);\n  } return dP(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P) {\n  anObject(it);\n  var keys = enumKeys(P = toIObject(P));\n  var i = 0;\n  var l = keys.length;\n  var key;\n  while (l > i) $defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P) {\n  return P === undefined ? _create(it) : $defineProperties(_create(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key) {\n  var E = isEnum.call(this, key = toPrimitive(key, true));\n  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;\n  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {\n  it = toIObject(it);\n  key = toPrimitive(key, true);\n  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;\n  var D = gOPD(it, key);\n  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it) {\n  var names = gOPN(toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it) {\n  var IS_OP = it === ObjectProto;\n  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif (!USE_NATIVE) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');\n    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function (value) {\n      if (this === ObjectProto) $set.call(OPSymbols, value);\n      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, createDesc(1, value));\n    };\n    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });\n    return wrap(tag);\n  };\n  redefine($Symbol[PROTOTYPE], 'toString', function toString() {\n    return this._k;\n  });\n\n  $GOPD.f = $getOwnPropertyDescriptor;\n  $DP.f = $defineProperty;\n  require('./_object-gopn').f = gOPNExt.f = $getOwnPropertyNames;\n  require('./_object-pie').f = $propertyIsEnumerable;\n  require('./_object-gops').f = $getOwnPropertySymbols;\n\n  if (DESCRIPTORS && !require('./_library')) {\n    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  wksExt.f = function (name) {\n    return wrap(wks(name));\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });\n\nfor (var es6Symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);\n\nfor (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);\n\n$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function (key) {\n    return has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');\n    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;\n  },\n  useSetter: function () { setter = true; },\n  useSimple: function () { setter = false; }\n});\n\n$export($export.S + $export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it) {\n    var args = [it];\n    var i = 1;\n    var replacer, $replacer;\n    while (arguments.length > i) args.push(arguments[i++]);\n    $replacer = replacer = args[1];\n    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n    if (!isArray(replacer)) replacer = function (key, value) {\n      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n      if (!isSymbol(value)) return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE][TO_PRIMITIVE] || require('./_hide')($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\nsetToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\nsetToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\nsetToStringTag(global.JSON, 'JSON', true);\n","\n/**\n * @fileoverview Polyfills included for Emojityper on non-module browsers.\n */\n\nimport '../../node_modules/core-js/modules/es6.string.starts-with';\nimport '../../node_modules/core-js/modules/es6.string.from-code-point';\nimport '../../node_modules/core-js/modules/es6.array.from';\nimport '../../node_modules/core-js/modules/es6.promise';\nimport '../../node_modules/core-js/modules/es6.symbol';\n\n// IE11 CustomEvent\nif (typeof window.CustomEvent !== 'function') {\n  function CustomEvent(name, params) {\n    params = params || {bubbles: false, cancelable: false, detail: undefined};\n    const event = document.createEvent('CustomEvent');\n    event.initCustomEvent(name, params.bubbles, params.cancelable, params.detail);\n    return event;\n  }\n  CustomEvent.prototype = window.Event.prototype;\n  window.CustomEvent = CustomEvent;\n}\n\n// IE11 Element.remove\nif (!Element.prototype.hasOwnProperty('remove')) {\n  Object.defineProperty(Element.prototype, 'remove', {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function remove() {\n      this.parentNode && this.parentNode.removeChild(this);\n    },\n  });\n}\n\n// IE11 classList.toggle 2nd arg\nconst testEl = document.createElement('div');\ntestEl.classList.toggle('testClass', false);\nif (testEl.classList.contains('testClass')) {\n  const original = DOMTokenList.prototype.toggle;\n  DOMTokenList.prototype.toggle = function(name, force) {\n    if (force === undefined) {\n      return original.call(this, name);\n    } else if (force) {\n      this.add(name);\n    } else {\n      this.remove(name);\n    }\n    return this.contains(name);\n  };\n}\n\n// IE11 Element.matches / Element.closest\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n}\n\nif (!Element.prototype.closest) {\n  Element.prototype.closest = function(s) {\n    let el = this;\n    if (!document.documentElement.contains(el)) {\n      return null;\n    }\n    do {\n      if (el.matches(s)) { return el; }\n      el = el.parentElement || el.parentNode;\n    } while (el && el.nodeType === 1);\n    return null;\n  };\n}\n\n// non-polyfill for window.fetch\nif (!window.fetch) {\n  window.fetch = () => Promise.reject('unsupported');\n}\n\n// for async/await magic\n// nb. this puts regeneratorRuntime into the top-level scope\nimport '../../node_modules/regenerator-runtime/runtime.js';\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // In sloppy mode, unbound `this` refers to the global object, fallback to\n  // Function constructor if we're in global strict mode. That is sadly a form\n  // of indirect eval which violates Content Security Policy.\n  (function() { return this })() || Function(\"return this\")()\n);\n","\n/**\n * @fileoverview Polyfills needed for modern browsers, even those supporting ES6 modules.\n */\n\nif (!window.requestIdleCallback) {\n  // TODO: this is a pretty terrible requestIdleCallback\n  window.requestIdleCallback = (callback) => {\n    const start = performance.now();\n    const fn = callback.bind(null, {\n      didTimeout: false,\n      timeRemaining: () => Math.max(0, 50 - (performance.now() - start)),\n    });\n    return window.setTimeout(fn, 1);\n  };\n\n  window.cancelIdleCallback = id => window.clearTimeout(id);\n}\n\nif (!navigator.sendBeacon) {\n  navigator.sendBeacon = function(url, body) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open('POST', url, true);\n      xhr.onerror = reject;\n      xhr.onload = resolve;\n      xhr.send(body);\n    });\n  };\n}\n","\nconst arrowKeys = ['Left', 'Right', 'Up', 'Down'];\n\n/**\n * @param {!Event} ev\n * @return {?string} one of \"Arrow{Left,Right,Up,Down}\" if this is a keyboard event of that arrow\n */\nexport function arrowFromEvent(ev) {\n  if (!ev.key) {\n    return null;\n  }\n  if (ev.key.startsWith('Arrow')) {\n    return ev.key;\n  }\n  if (arrowKeys.indexOf(ev.key) === -1) {\n    return null;\n  }\n  return 'Arrow' + ev.key;\n}\n\n/**\n * @param {!Event} ev\n * @return {boolean} whether this is probably a keyboard/non-mouse click\n */\nexport function isKeyboardClick(ev) {\n  if (!(ev instanceof MouseEvent)) {\n    return true;\n  }\n  return (ev.screenX === 0 && ev.detail === 0) || ev.webkitForce === 0;\n}","\nlet dummy;\n\nexport function copyText(text) {\n  if (!dummy) {\n    dummy = document.createElement('input');\n    dummy.style.position = 'fixed';\n    dummy.style.opacity = 0;\n    document.body.appendChild(dummy);\n  }\n\n  dummy.value = text;\n  try {\n    dummy.hidden = false;\n    dummy.focus();\n    dummy.selectionStart = 0;\n    dummy.selectionEnd = dummy.value.length;\n    document.execCommand('copy');\n  } catch (e) {\n    return false;\n  } finally {\n    dummy.hidden = true;\n  }\n\n  return true;\n}","\n/**\n * @fileoverview Handles the buttons in the top-right of the page (currently just Copy).\n */\n\nimport * as eventlib from './lib/event.js';\nimport * as copier from './lib/copier.js';\n\nconst all = Array.from(input.querySelectorAll('button'));\n\nconst handler = (ev) => {\n  const text = ev.detail.trim();\n  const hasValue = Boolean(text);\n  all.forEach((button) => button.disabled = !hasValue);\n};\ntyper.addEventListener('value', handler);\nhandler({detail: typer.value});\n\nconst buttonTextShow = 500;\n\nfunction notifyParentCopy() {\n  // notify parent (for ext)\n  if (window.parent) {\n    window.parent.postMessage('copy', '*');\n  }\n}\n\n// copy handler\n(function(button, input) {\n  let timeout;\n  const defaultText = button.textContent;\n  const spaceRe = /\\s*/;\n\n  const copy = () => {\n    const text = input.dataset['copy'].trim().replace(/\\s+/, ' ');\n    if (!copier.copyText(text)) {\n      console.warn('could not copy', text)\n      return true;\n    }\n    console.info('copied', text);\n\n    // analytics\n    ga('send', 'event', 'text', 'copy');\n\n    // show 'Copied!' message\n    button.textContent = button.dataset['copied'];\n    button.classList.add('copied');\n    window.clearTimeout(timeout);\n    timeout = window.setTimeout((ev) => {\n      button.textContent = defaultText;\n      button.classList.remove('copied');\n      maybeReleaseInputEnter();\n      notifyParentCopy();\n    }, buttonTextShow);\n  };\n\n  let wasInputEnter = false;\n  input.addEventListener('keydown', (ev) => {\n    if (wasInputEnter) {\n      // do nothing, enter is being _held_\n    } else if (ev.key === 'Enter' && !ev.repeat) {\n      button.click();\n      button.focus();\n      wasInputEnter = true;\n      ev.preventDefault();\n    }\n  });\n  document.body.addEventListener('keyup', (ev) => {\n    if (ev.key === 'Enter') {\n      maybeReleaseInputEnter();\n    }\n  });\n  button.addEventListener('click', (ev) => {\n    ev.preventDefault();\n    if (wasInputEnter || ev.repeat) {\n      return;  // click is generated as the user holds enter\n    }\n    copy();\n    if (eventlib.isKeyboardClick(ev)) {\n      // if the user tabbed here, keep focus\n      button.focus();\n    }\n  });\n\n  function maybeReleaseInputEnter() {\n    if (wasInputEnter) {\n      if (document.activeElement === button) {\n        input.focus();  // maybe focus moved\n      }\n      wasInputEnter = false;\n    }\n  }\n\n}(copy, typer));\n\n","\n/**\n * Decodes a JavaScript string into Unicode code points.\n *\n * @param {string} s to decode\n * @return {!Array<number>} code points\n */\nexport function jsdecode(s) {\n  const len = s.length;\n  const points = [];\n\n  for (let i = 0; i < len;) {\n    const raw = s.charCodeAt(i++) || 0;\n    if (raw < 0xd800 || raw > 0xdbff || i === len) {\n      // not a high surrogate, or end of string\n    } else {\n      const extra = s.charCodeAt(i) || 0;\n      if ((extra & 0xfc00) === 0xdc00) {\n        // got a low surrogate, eat 2nd char\n        ++i;\n        points.push(0x10000 + (extra & 0x3ff) + ((raw & 0x3ff) << 10));\n        continue;\n      }\n    }\n    points.push(raw);\n  }\n\n  return points;\n}\n","\nimport {jsdecode} from './string.js';\n\nexport const runeZWJ = 0x200d;\nexport const runeCap = 0x20e3;\nexport const runeVS16 = 0xfe0f;\nexport const runeTagCancel = 0xe007f;\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a diversity selector (one of five skin tones)\n */\nexport function isSkinTone(p) {\n  return p >= 0x1f3fb && p <= 0x1f3ff;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is one of A-Z for flags\n */\nexport function isFlagPoint(p) {\n  return p >= 0x1f1e6 && p <= 0x1f1ff;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a tag character, for tag sequences\n */\nexport function isTag(p) {\n\treturn p >= 0xe0020 && p < 0xe007f\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune can appear before a keycap\n */\nexport function isBeforeCap(p) {\n  return p === 35 || p === 42 || (p >= 48 && p <= 57)  // #, * or 0-9\n}\n\n/**\n * @type {!Array<number>}\n */\nconst skippable = [runeVS16, runeCap, runeTagCancel];\n\n/**\n * Returns a count of the expected number of points displayed for the given valid emoji string.\n *\n * Assumes the emoji is normalized/well-formed: if not, the result will likely just be lower than\n * rendered, and it'll be considered invalid anyway.\n *\n * @param {string} s\n * @return {number} count\n */\nexport function emojiPointCount(s) {\n  const points = jsdecode(s);\n  return _emojiPointCount(points);\n}\n\n/**\n * @param {!Array<number>} points\n * @return {number} count\n */\nexport function _emojiPointCount(points) {\n  let halfCount = 0;\n  const l = points.length;\n  for (let i = 0; i < l; ++i) {\n    const p = points[i];\n    if (p === runeZWJ) {\n      halfCount -= 2;\n    } else if (skippable.indexOf(p) !== -1 || isTag(p) || isSkinTone(p)) {\n      // do nothing\n    } else if (isFlagPoint(p) && points[i+1] !== runeVS16) {\n      ++halfCount;\n    } else {\n      halfCount += 2;\n    }\n  }\n\n  if (points.length === 0) {\n    return 0;  // no points\n  } else if (halfCount <= 2) {\n    return 1;  // return minimum if string had content\n  } else {\n    return (halfCount + 1) >> 1;  // round up\n  }\n}\n\n/**\n * @param {string} s\n * @yield {?Array<number>}\n */\nexport function *iterateEmoji(s) {\n  const points = jsdecode(s);\n  yield *_iterateEmoji(points);\n}\n\n/**\n * @param {!Array<number>} points\n * @yield {?Array<number>}\n */\nexport function *_iterateEmoji(points) {\n  let curr = {flag: false, v: []};\n  const pending = [curr];\n\n  const ensure = (flag) => {\n    if (curr.flag !== flag) {\n      curr = {flag, v: []};\n      pending.push(curr);\n    }\n  };\n\n  const l = points.length;\n  for (let i = 0; i < l; ++i) {\n    const p = points[i];\n\n    if (isFlagPoint(p) && points[i+1] !== runeVS16) {\n      ensure(true);  // force flag mode\n      curr.v.push(p);\n    } else if (skippable.indexOf(p) !== -1 || isTag(p) || isSkinTone(p) || p === runeZWJ) {\n      ensure(false);  // force regular mode\n      curr.v.push(p);\n    } else {\n      // ensure new char unless we follow a ZWJ\n      const off = curr.v.length - 1;\n      if (off !== -1 && curr.v[off] !== runeZWJ) {\n        curr = {flag: false, v: [p]};\n        pending.push(curr);\n      } else {\n        curr.v.push(p);\n      }\n    }\n\n    while (pending.length > 1) {\n      const cand = pending.shift();\n      if (cand.v.length) {\n        yield cand.v;\n      }\n    }\n  }\n\n  const tail = pending[0];\n  if (tail.v.length) {\n    yield tail.v;\n  }\n}\n\n/**\n * Stringifies the given emoji char. By default, generates e.g. \"1f575_fe0f_200d_2642\" or \"23_20e3\".\n *\n * @param {string} s\n * @param {{sep: string, pad: number, lower: boolean, unqualify: boolean}=} opts\n * @return {string}\n */\nexport function stringify(s, opts={}) {\n  const points = jsdecode(s);\n  return _stringify(points, opts);\n}\n\n/**\n * @param {!Array<number>} points\n * @param {{sep: string, pad: number, lower: boolean, unqualify: boolean}=} opts\n * @return {string}\n */\nexport function _stringify(points, opts = {}) {\n  const def = {sep: '_', pad: 0, lower: true, unqualify: true};\n  const {sep, pad, lower, unqualify} = Object.assign(def, opts);\n  if (unqualify) {\n    points = points.filter((part) => part !== runeVS16);\n  }\n  const parts = points.map((point) => {\n    let part = point.toString(16);\n    if (!lower) {\n      part = part.toUpperCase();\n    }\n    return '0'.repeat(Math.max(0, pad - part.length)) + part;\n  });\n  return parts.join(sep);\n}","\nimport {emojiPointCount, _emojiPointCount, _iterateEmoji, isFlagPoint, runeVS16} from './emoji.js';\nimport {jsdecode} from './string.js';\n\n// are we on a platform where emoji are all fixed width? This enables our fast-path.\nconst fixedWidthEmoji =\n    Boolean(/Mac|iP(hone|od|ad)/.exec(navigator.platform)) ||  // Mac and iOS\n    Boolean(/Android/.exec(navigator.userAgent))           ||  // Android\n    false;\n\n// on Windows, the initial Man or Woman of an emoji sequence gets a space after it\n// ...well, Edge struggles with couples/family, Chrome is _just_ couples\nconst needsManWomanHack = Boolean(/Win/.exec(navigator.platform));\n\nconst letterSpacing = 1024;  // must be sensibly large enough so we round over emoji\nconst fontSize = 100;        // large enough to unambiguate other wide chars\n\nconst hider = document.createElement('div');\nhider.style.overflow = 'hidden';\nhider.style.width = '0px';\nhider.style.position = 'absolute';\nhider.setAttribute('href', 'https://github.com/samthor/ok-emoji');\n\nconst measurer = document.createElement('div');\nmeasurer.style.display = 'inline-block';\nmeasurer.style.whiteSpace = 'nowrap';\nmeasurer.style.fontSize = `${fontSize}px`;\nmeasurer.style.lineHeight = 'normal';\nmeasurer.style.fontFamily = 'sans-serif';\n\nhider.appendChild(measurer);\ndocument.body.appendChild(hider);\n\n/**\n * @return {{width: number, height: number}}\n */\nfunction measure() {\n  // use the height of the hider, as it grows to expand 'large' chars (the measurer itself doesn't)\n  // grow, it just renders 'outside'\n  const box = hider.getBoundingClientRect();\n  return {width: measurer.offsetWidth, height: hider.offsetHeight};\n}\n\n// render a char that will show up as an invalid Unicode square box\nmeasurer.textContent = '\\u{ffffd}';\nconst invalidBoxSize = measure();\n\n// render an emoji\nmeasurer.textContent = '\\u{1f602}';\nconst validEmojiSize = measure();\n\n// check invalid vs emoji\nexport const isSingleAmbig = (validEmojiSize.height === invalidBoxSize.height) && !fixedWidthEmoji;\nif (isSingleAmbig) {\n  // This is somewhat unlikely, but possible. In this case, we can't tell single characters from\n  // emoji, because everything has the same height.\n  // console.warn(`unable to tell single char from emoji char`);\n}\n// _now_ set letterSpacing for rest\nmeasurer.style.letterSpacing = `${letterSpacing}px`;\n\n/**\n * @type {(null|function(string): number)}\n */\nconst fixedWidthMeasure = (function() {\n  if (!fixedWidthEmoji) {\n    return null;\n  }\n\n  // nb. The choice of canvasFontSize leverages weird Mac quirks. Using e.g. 1 or 100 doesn't\n  // work; 10.5 seems to work well, because other fixed-width single-chars are different size.\n  // Ostensibly, emoji don't like to render on pixel widths, and on macOS 10.13 it rounds up to 14.\n  const canvasFontSize = 10.5;\n\n  const canvas = /** @type {!HTMLCanvasElement} */ (document.createElement('canvas'));\n  const context = /** @type {!CanvasRenderingContext2D} */ (canvas.getContext('2d'));\n  context.font = `${canvasFontSize}px monospace`;\n  const expectedWidth = context.measureText('\\u{1f602}').width;  // fixed width of emoji\n\n  return function fixedWidthMeasure(s) {\n    const width = context.measureText(s).width;\n    return width / expectedWidth;\n  }\n}());\n\n/**\n * @param {string} s to measure\n * @return {number} the number (approx) of characters rendered\n */\nexport function countRenderPoints(s) {\n  measurer.textContent = s;\n  return Math.round(measurer.offsetWidth / (letterSpacing + fontSize));\n}\n\n/**\n * @param {string} s to examine\n * @return {number} the number of extra rendered chars to allow\n */\nconst countExtraAllowed = (function() {\n  if (!needsManWomanHack) {\n    return () => 0;\n  }\n\n  return (s) => {\n    let extra = 0;\n    let index = -1;\n    for (;;) {\n      index = s.indexOf('\\u{200d}\\u{d83d}', index+1);  // ZWJ plus first byte of person (man/woman)\n      if (index === -1) {\n        break;\n      }\n      const cand = s.charCodeAt(index+2);\n      if (cand === 56424 || cand === 56425) {\n        ++extra;\n      }\n    }\n    return extra;\n  }\n}());\n\n/**\n * @param {string} s\n * @return {boolean} whether this is a single valid emoji (width is single, and not an invalid box)\n */\nexport const isSingleValidEmoji = (function() {\n  if (fixedWidthEmoji) {\n    return function isSingleValidEmoji(s) {\n      return fixedWidthMeasure(s) === 1;\n    };\n  }\n\n  return function isSingleValidEmoji(s) {\n    measurer.textContent = s;\n    const rect = measure();\n\n    const expected = 1 + countExtraAllowed(s);\n    const len = Math.round(rect.width / (letterSpacing + fontSize));\n    if (len > expected) {\n      return false;  // expected single char\n    } else if (validEmojiSize.height !== rect.height) {\n      // nb. This isn't perfect, it's very plausible that there are some random Unicode points\n      // that on the user's system which have the same height as the emoji itself.\n      return false;  // not emoji height\n    }\n    return invalidBoxSize.width !== rect.width - letterSpacing;\n  }\n}());\n\n/**\n * @param {string} s\n * @return {boolean} whether this is the expected length of an emoji-only string\n */\nexport const isExpectedLength = (function() {\n  if (fixedWidthEmoji) {\n    return function isExpectedLength(s) {\n      const actual = fixedWidthMeasure(s);\n      const expected = emojiPointCount(s);\n      if (~~actual !== actual) {\n        return false;  // must be whole emoji chars\n      }\n      return actual <= expected;\n    };\n  }\n\n  // isExpectedLength implementation for variable width environments (anywhere but Apple or\n  // Android). Windows, Linux and others render emoji with variable width. But all platforms render\n  // emoji with fixed height.\n  // TODO: If we're wrong then remove the height checks.\n  return function isExpectedLength(s) {\n    measurer.textContent = s;\n    if (hider.offsetHeight !== validEmojiSize.height) {\n      return false;  // early out, text doesn't have emoji height\n    }\n\n    const points = jsdecode(s);\n    const expected = _emojiPointCount(points) + countExtraAllowed(s);\n    const renderPoints = countRenderPoints(s);\n    if (renderPoints > expected) {\n      return false;  // early out, catches uncombinables\n    }\n\n    // iterate through emoji parts, check all of them for validity\n    for (const part of _iterateEmoji(points)) {\n      if (part === null) {\n        return false;  // got invalid part\n      }\n\n      // special-case flags, which we get in bulk\n      if (isFlagPoint(part[0])) {\n        if (part[1] === runeVS16) {\n          continue;\n        } else if (part.length % 2) {\n          return false;  // flags must be pairs\n        }\n        for (let i = 0; i < part.length; i += 2) {\n          const text = String.fromCodePoint(part[i], part[i+1]);\n          if (!isSingleValidEmoji(text)) {\n            return false;\n          }\n        }\n        continue;\n      }\n\n      // check is single char\n      const text = String.fromCodePoint(...part);\n      if (!isSingleValidEmoji(text)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n}());\n","\nimport {cacheFor} from './cache.js';\nimport {jsdecode} from '../../node_modules/ok-emoji/src/string.js';\nimport {isSingleValidEmoji} from '../../node_modules/ok-emoji/src/measurer.js';\nimport * as emoji from '../../node_modules/ok-emoji/src/emoji.js';\n\n/**\n * @param {string} string to measure\n * @return {boolean} whether this is a single emoji long\n */\nconst isSingle = cacheFor(isSingleValidEmoji);\n\n/**\n * True if the standard \"female\" icon can be varied with a diversity modifier. This is the basic\n * level of emoji diversity support, but doesn't imply support for all the professions.\n *\n * @type {boolean}\n */\nconst basicDiversity = isSingle('\\u{1f468}\\u{1f3fb}');\n\n/**\n * @type {!Array<number>}\n */\nconst skipDiversityList = [\n  0x1f91d,  // handshake\n  0x1f46a,  // nuclear family\n  0x1f93c,  // people wrestling\n  0x1f46b,  // m+w hands\n  0x1f46c,  // m+m hands\n  0x1f46d,  // w+w hands\n];\n\n/**\n * @param {number} p\n * @return {boolean} whether to skip diversity for this point\n */\nfunction skipDiversity(p) {\n  return skipDiversityList.indexOf(p) !== -1;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a gender character\n */\nfunction isPointGender(p) {\n  return p === 0x2640 || p === 0x2642;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a basic emoji person gender: Man or Woman\n */\nfunction isPersonGender(p) {\n  return p === 0x1f468 || p === 0x1f469;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether this is a subordinate member of a family sequence: boy/girl/baby\n */\nfunction isFamilyMember(p) {\n  return p === 0x1f476 || p === 0x1f466 || p === 0x1f467;\n}\n\n/**\n * Returns details about a character and whether it can be gender flipped to a single or neutral\n * gender. This contains emoji which, due to historical emoji reasons, aren't officially versions\n * of each other: e.g., Santa and Mrs. Claus, or Old {Man,Woman,Adult}.\n *\n * @param {number} point to look up in the other gender flips table\n * @return {{single: boolean, neutral: boolean, points: {f: number, m: number, n: number}}?}\n */\nconst genderFlip = (function() {\n  const list = [\n    0x1f468, 0x1f469, 0,        // man, woman (normal case)\n    0x1f936, 0x1f385, 0,        // mrs. claus, santa\n    0x1f483, 0x1f57a, 0,        // dancers\n    0x1f470, 0x1f935, 0,        // bride, man in tuxedo\n    0x1f467, 0x1f466, 0x1f9d2,  // girl, boy, child\n    0x1f475, 0x1f474, 0x1f9d3,  // old {woman,man,adult}\n    0x1f46d, 0x1f46c, 0x1f46b,  // women/men holding hands; note this has 'mixed' for neutral\n    0x1f478, 0x1f934, 0,        // princess, prince\n  ];\n\n  // build map with raw data only\n  const all = new Map();\n  for (let i = 0; i < list.length; i += 3) {\n    const data = {\n      points: {f: list[i], m: list[i+1], n: list[i+2]},\n    };\n    for (let j = 0; j < 3; ++j) {\n      const v = list[i+j];\n      if (v) {\n        if (all.has(v)) {\n          throw new Error('duplicate in gender list: ' + v);\n        }\n        all.set(v, data);\n      }\n    }\n  }\n\n  // return helper\n  return (point) => {\n    const out = all.get(point) || null;\n    if (out && out.single === undefined) {\n      // do the heavy lifting only when first fetched\n      out.single =\n          isSingle(String.fromCodePoint(out.points.f)) &&\n          isSingle(String.fromCodePoint(out.points.m));\n      out.neutral = out.points.n ? isSingle(String.fromCodePoint(out.points.n)) : false;\n    }\n    return out;\n  };\n}());\n\n/**\n * @param {!Array<number>} points\n * @yields {{part: !Array<number>, trailer: boolean}}\n */\nfunction *reverseParts(points) {\n  let last = -1;\n\n  // nb. this actually works in reverse\n  do {\n    // ugh so many off by ones\n    const index = points.lastIndexOf(emoji.runeZWJ, last);\n    const from = index + 1;\n    const to = (last === -1 ? points.length : last + 1);\n    last = index - 1;\n\n    const part = points.slice(from, to);\n    if (part.length === 0) {\n      continue;  // ignore empty char\n    }\n\n    const x = {part: points.slice(from, to), trailer: from !== 0};\n    yield x;\n  } while (last !== -2);\n}\n\n/**\n * @param {!Array<number>} points\n * @return {!Array<!Array<number>>}\n */\nfunction splitPoints(points) {\n  let last = 0;\n  const out = [];\n\n  for (;;) {\n    const index = points.indexOf(emoji.runeZWJ, last);\n    const to = (index === -1 ? points.length : index);\n\n    const part = points.slice(last, to);\n    if (part.length !== 0) {\n      out.push(part);\n    }\n\n    if (index === -1) {\n      break;\n    }\n    last = index + 1;\n  }\n\n  return out;\n}\n\n/**\n * Analyses or modifes an emoji string for modifier support: diversity and gender.\n *\n * This might be O(n), due to the cost of measuring every individual character on some platforms.\n *\n * @param {string} s\n * @param {{tone: (undefined|number), gender: (undefined|string)}=} op\n * @return {\n *   out: (string|undefined),\n *   tone: boolean,\n *   gender: {single: boolean, double: boolean, neutral: boolean},\n * }\n */\nexport function modify(s, op=undefined) {\n  const stats = {tone: false, gender: {single: false, double: false, neutral: false}};\n\n  const all = op !== undefined ? [] : null;\nouter:\n  for (const points of emoji.iterateEmoji(s)) {\n    if (all) {\n      all.push(points);  // store for 2nd round\n    }\n\n    let genderable = 0;\n    let familyLike = false;\n\n    for (const {part, trailer} of reverseParts(points)) {\n      // check for early exhaustive answer\n      if (op === undefined &&\n        (stats.tone || !basicDiversity) &&\n        stats.gender.neutral && stats.gender.single && stats.gender.double) {\n        break outer;\n      }\n\n      const first = part[0];\n\n      if (emoji.isFlagPoint(first)) {\n        continue;\n      }\n\n      const localFamilyMember = isFamilyMember(first)\n      if (trailer && localFamilyMember) {\n        familyLike = true;   // familyLike is family member in later part of char\n      }\n\n      const localPersonGender = isPersonGender(first)\n      if (localFamilyMember || localPersonGender) {\n        stats.tone = !familyLike && basicDiversity;\n        stats.gender.single = true;\n        if (localPersonGender && ++genderable >= 2) {\n          stats.gender.double = true;\n        }\n        continue;  // nothing more to find out here\n      }\n\n      if (familyLike) {\n        continue;  // no more checks to do\n      }\n\n      // check for prescribed gender flips\n      const flip = genderFlip(first);\n      if (flip !== null) {\n        stats.gender.single |= flip.single;\n        stats.gender.neutral |= flip.neutral;\n      }\n\n      // measure if diversity is possible (only on first char)\n      if (basicDiversity && !stats.tone && !trailer && !skipDiversity(first)) {\n        const cand = String.fromCodePoint(first, 0x1f3fb);\n        stats.tone = isSingle(cand);\n      }\n\n      // measure if gender is possible\n      if (!stats.gender.neutral) {\n        const cand = String.fromCodePoint(first, emoji.runeZWJ, 0x2640, emoji.runeVS16);\n        const valid = isSingle(cand);\n        stats.gender.neutral = valid;\n        stats.gender.single = stats.gender.single || valid;\n      }\n    }\n  }\n\n  if (op === undefined) {\n    return stats;\n  }\n\n  if (op.tone !== undefined && stats.tone) {\n    // nb. tones are only ever valid in position 1\n    all.forEach((points) => {\n      if (emoji.isSkinTone(points[1])) {\n        // found one, either replace or clear\n        if (op.tone) {\n          // great, save in place\n          points[1] = op.tone;\n        } else {\n          const cand = String.fromCodePoint(points[0]);\n          if (!isSingle(cand)) {\n            points[1] = emoji.runeVS16;  // tone was holding this as emoji\n          } else {\n            points.splice(1, 1);  // just remove\n          }\n        }\n        return;  // in-place update\n      }\n\n      if (!op.tone) {\n        // just remove in case one's in a weird place\n        const update = points.filter((point) => !emoji.isSkinTone(point));\n        points.splice(0, points.length, ...update);\n        return;  // in-place update\n      }\n\n      if (skipDiversity(points[0])) {\n        return;  // skip\n      }\n\n      const cand = String.fromCodePoint(points[0], op.tone, ...points.slice(1));\n      if (!isSingle(cand)) {\n        return;\n      }\n      points.splice(1, 0, op.tone);\n    });\n  }\n\n  if (op.gender !== undefined) {\n    const splitAll = all.map((points) => splitPoints(points));\n    const updateSplitAll = splitAll.map((parts, i) => {\n      // check last point first\n      const hadTrailingGender = isPointGender(parts[parts.length - 1][0]);\n\n      // look for gendered emoji at start of all and flip\n      if (!hadTrailingGender) {\n        let localOp = [];\n        let foundAny = false;\n        for (let i = 0; i < parts.length; ++i) {\n          const part = parts[i];\n          const first = part[0];\n\n          const flip = genderFlip(first);\n          if (!flip) {\n            if (i === 0) {\n              break;  // genderable will always be first, give up\n            }\n            continue;\n          }\n\n          // if we're out of ops, split for more (this might still be blank, but reset anyway)\n          localOp = localOp.length ? localOp : op.gender.split('');\n          const next = localOp.shift();\n          if (foundAny && (!next || isFamilyMember(first))) {\n            break;  // if we've already matched some, and now have no more data / is family, fail\n          }\n\n          if (!next && flip.neutral) {\n            part[0] = flip.points.n;\n          } else if (next && flip.single) {\n            part[0] = (next === 'm' ? flip.points.m : flip.points.f);\n          }\n          foundAny = true;\n        }\n        if (foundAny) {\n          return parts;  // don't try to add a gender modifier\n        }\n\n        // now, either change trailing gender or try to add one\n        if (!op.gender) {\n          return null;  // nothing to do\n        }\n\n        // we need to see if it's possible, clone _whole_ emoji\n        const run = all[i].slice();\n        run.push(emoji.runeZWJ, 0x2640, emoji.runeVS16);\n        const cand = String.fromCodePoint(...run);\n        if (!isSingle(cand)) {\n          return null;\n        }\n        parts.push([0x2640, emoji.runeVS16]);  // we change this below\n      } else if (!op.gender) {\n        parts.pop();\n        return parts;\n      }\n\n      const last = parts[parts.length - 1];\n      last[0] = (op.gender[0] === 'm' ? 0x2642 : 0x2640);\n      return parts;\n    });\n\n    // remerge changed parts\n    updateSplitAll.forEach((parts, i) => {\n      if (parts === null) {\n        return;  // nothing changed here\n      }\n      const merged = [];\n      parts.forEach((part) => {\n        merged.push(...part, emoji.runeZWJ);\n      });\n      merged.pop();  // remove trailing ZWJ\n      all[i] = merged;\n    });\n  }\n\n  stats.out = all.map((points) => String.fromCodePoint(...points)).join('');\n  return stats;\n}\n","\nexport function cacheFor(fn, limit=4000) {\n  let cache = {};\n  let count = 0;\n\n  return (arg) => {\n    let result = cache[arg];\n    if (result === undefined) {\n      cache[arg] = result = fn(arg);\n      if (++count > limit) {\n        cache = {};\n        count = 0;\n      }\n    }\n    return result;\n  };\n}","\nimport * as emoji from '../../node_modules/ok-emoji/src/emoji.js';\n\n// TODO(samthor): Just use this on supported browsers.\n// const re = new RegExp(/(?:[\\p{Letter}\\p{Number}])/u);\n\nfunction letterAt(text, pos) {\n  const code = text.charCodeAt(pos);\n  const after = text.charCodeAt(pos + 1);\n\n  if (after === emoji.runeVS16) {\n    return false;  // VS16 follows\n  }\n\n  // return Boolean(re.exec(text.substr(pos, 1)));\n  return code < 5000 && code > 32;\n}\n\nexport function match(text, at) {\n  let from = at;\n  let to = at;\n\n  // are we at the end (only have spaces until end)?\n  const isAtEnd = text.substr(at).trim() === '';\n  const isNotWordAfter = isAtEnd || !letterAt(text, at);\n\n  if (isNotWordAfter) {\n    for (; to > 0; --to) {\n      if (text.charCodeAt(to - 1) > 32) {\n        break;\n      }\n    }\n    if (to < from) {\n      from = to;\n    }\n  }\n\n  // walk backwards while the previous character is a word\n  for (; from > 0; --from) {\n    if (!letterAt(text, from - 1)) {\n      break;\n    }\n  }\n\n  // walk forwards while the next char is not a space\n  for (; to < text.length; ++to) {\n    if (!letterAt(text, to)) {\n      break;\n    }\n  }\n\n  if (from > to) {\n    from = to;\n  }\n  return {from, to};\n}","\nimport * as modifier from './lib/modifier.js';\nimport * as word from './lib/word.js';\n\nfunction datasetSafeDelete(el, ...keys) {\n  const d = el.dataset;\n  keys.forEach((key) => {\n    if (key in d) {\n      delete d[key];\n    }\n  });\n}\n\nconst upgraded = new WeakMap();\n\nexport function cursorPosition(el) {\n  const fn = upgraded.get(el);\n  if (fn !== undefined) {\n    return fn();\n  }\n  return undefined;\n}\n\n// word focus handler\nfunction upgrade(el) {\n  if (upgraded.has(el)) {\n    return false;\n  }\n\n  // stores the faux-selection shown (different from actual selection in 'state')\n  const sel = {\n    from: el.selectionStart,\n    to: el.selectionEnd,\n  };\n\n  const helper = document.createElement('div');\n  helper.className = 'overflow-helper';\n  el.parentNode.insertBefore(helper, el);\n\n  const underline = document.createElement('div');\n  underline.className = 'underline';\n  helper.appendChild(underline);\n\n  let suggest = null;\n  const autocomplete = document.createElement('div');\n  autocomplete.className = 'autocomplete sizer';\n  helper.appendChild(autocomplete);\n\n  // measures the width of text\n  const measureText = (function() {\n    const sizer = document.createElement('div');\n    sizer.className = 'sizer';\n    helper.appendChild(sizer);\n\n    const nonce = document.createElement('div');\n    nonce.className = 'nonce';\n\n    return (text) => {\n      sizer.textContent = text;\n      sizer.appendChild(nonce);\n      return nonce.offsetLeft;\n    }\n  }());\n\n  // record upgraded measurer for callers to find our pixel position\n  upgraded.set(el, () => {\n    const mid = ~~((el.selectionStart + el.selectionEnd) / 2)\n    return measureText(el.value.substr(0, mid)) - el.scrollLeft;\n  });\n\n  // hide underline until load: the font used might not be ready, so it's probably out of whack\n  if (document.readyState !== 'complete') {\n    underline.classList.add('loading');\n    window.addEventListener('load', (ev) => {\n      renderLine();\n      underline.classList.remove('loading');\n    });\n  }\n\n  const renderLine = () => {\n    if (sel.from >= sel.to) {\n      underline.hidden = true;\n      return false;\n    }\n    const {from, to} = sel;\n\n    // otherwise, record and draw the line\n    const left = measureText(el.value.substr(0, from));\n    const width = measureText(el.value.substr(from, to - from));\n\n    if (width < 0 && !document.getElementById('less')) {\n      // nb. this seems to happen in dev with lesscss\n      console.warn('invalid sizer width', width, 'for text', sizer.textContent);\n    }\n\n    underline.hidden = width <= 0;\n    underline.style.left = left + 'px';\n    underline.style.width = width + 'px';\n    underline.style.transform = `translateX(${-el.scrollLeft}px)`;\n\n    // TODO(samthor): put in div with underline so alignment is free?\n    autocomplete.style.transform = `translateX(${-el.scrollLeft + left + width}px)`;\n  };\n\n  // force selection\n  const setRange = (from, to) => {\n    sel.from = from;\n    sel.to = Math.max(from, to);\n    if (from >= to) {\n      datasetSafeDelete(el, 'prefix', 'word', 'focus');\n      underline.hidden = true;\n      return false;\n    }\n    el.dataset['focus'] = el.value.substr(from, to - from);\n    renderLine();\n    return true;\n  };\n\n  // rerender autocomplete word if valid\n  const renderAutocomplete = () => {\n    const s = el.dataset['prefix'] || '';\n    const valid = suggest !== null &&\n        s.length !== 0 &&\n        (suggest.name[0] === '^' || suggest.name.substr(0, s.length) === s) &&\n        el.value.substr(sel.to).trim().length === 0;\n    if (!valid) {\n      autocomplete.textContent = '';\n      return false;\n    }\n    const display = (suggest.name[0] === '^' ? '' : suggest.name.substr(s.length)) + suggest.emoji;\n    autocomplete.textContent = display;\n    return true;\n  };\n\n  // state/handler keep track of the current focus word (plus scroll position, if input is big)\n  const initialLength = el.value.length;\n  const state = {start: initialLength, end: initialLength, value: undefined};\n  const changeHandler = (permitNextChange) => {\n    if (permitNextChange !== false &&\n        el.selectionStart === state.start &&\n        el.selectionEnd === state.end &&\n        el.value === state.value) {\n      return true;  // already at this state\n    }\n    [state.start, state.end] = [el.selectionStart, el.selectionEnd];\n    if (state.value !== el.value) {\n      el.dispatchEvent(new CustomEvent('value', {detail: el.value}));\n      state.value = el.value;\n    }\n\n    // we're pretending to be the user's selection\n    if (state.start !== state.end) {\n      datasetSafeDelete(el, 'prefix', 'word');\n\n      setRange(state.start, state.end);\n\n      underline.classList.add('range');\n      el.classList.add('range');\n      return false;\n    }\n    underline.classList.remove('range');\n    el.classList.remove('range');\n\n    // if it's invalid and we were permitted (this is used for faux-highlights), ignore\n    const {from, to} = word.match(el.value, state.start);\n    if (from >= to && permitNextChange) {\n      return false;  // we just got an emoji, retain implicit selection until next change\n    }\n    if (setRange(from, to)) {\n      // if the range was valid, update the prefix/focus but delete the word (in typing state)\n      el.dataset['focus'] = el.dataset['prefix'] = el.value.substr(from, to - from).toLowerCase();\n      datasetSafeDelete(el, 'word');\n    }\n    return false;\n  };\n\n  // runs change handler and emits the 'word' event as appropriate\n  let previousDetail = {};\n  let heldScrollLeft = 0;\n  const mergedEventHandler = (events, permitNextChange) => {\n    if (events.has('select-all')) {\n      // custom event generated by page.js\n      el.setSelectionRange(0, el.value.length);\n    } else if (events.has('select-end')) {\n      // custom event generated by options.js\n      el.setSelectionRange(el.value.length, el.value.length);\n    } else if (events.has('focus') && !(events.has('mousedown') || events.has('touchstart'))) {\n      // if there was a focus event, don't let the browser take over: reset previous known good\n      // ... unless the user used their mouse/cursor to select something\n      // TODO: this sets on initial load, even though it probably doesn't need to\n      el.setSelectionRange(state.start, state.end);\n    }\n\n    // some browsers set this to zero when we leave, restore it\n    if (events.has('blur') || events.has('focus')) {\n      // TODO(samthor): Safari flashes L/R on this. We probably don't care.\n      el.scrollLeft = heldScrollLeft;\n    }\n    heldScrollLeft = el.scrollLeft;\n\n    // run change handler: if true, nothing changed\n    // (nb. the logic before return is because autocompletes don't count for alreadyAtState)\n    const alreadyAtState = changeHandler(permitNextChange);\n\n    // clear suggestion if we tried to render it and it wasn't valid\n    if (!renderAutocomplete()) {\n      suggest = null;\n    }\n\n    // set dataset['copy'] to the value you'd copy if you hit enter right now\n    // TODO(samthor): Generate this only when we run a copy?\n    if (el.selectionStart !== el.selectionEnd) {\n      el.dataset['copy'] = el.value.substr(el.selectionStart, el.selectionEnd - el.selectionStart);\n    } else if (suggest !== null) {\n      el.dataset['copy'] = el.value.substr(0, sel.from) + el.value.substr(sel.to) + suggest.emoji;\n    } else {\n      el.dataset['copy'] = el.value;\n    }\n\n    // if nothing changed, don't trigger any option callbacks\n    if (alreadyAtState) { return; }\n\n    // send query: prefix or whole-word (unless nothing is focused)\n    const text = el.dataset['focus'] ? el.dataset['prefix'] || el.dataset['word'] || null : '';\n    const detail = {\n      text,\n      prefix: 'prefix' in el.dataset,\n      focus: el.dataset['focus'],\n      selection: (el.selectionStart !== el.selectionEnd),\n    };\n\n    // send event only if something has changed\n    if (detail.text !== previousDetail.text ||\n        detail.prefix !== previousDetail.prefix ||\n        detail.focus !== previousDetail.focus ||\n        detail.selection !== previousDetail.selection) {\n      previousDetail = detail;\n      el.dispatchEvent(new CustomEvent('query', {detail}));\n    }\n  };\n\n  // whether user typed space and nothing came out\n  let hasPendingSpace = false;\n\n  // dedup listeners on a rAF\n  let permitNextChange;  // FIXME: global-ish scope is ugly\n  (function() {\n    let frame;\n    let events = new Set();  // records the events that occured to cause this\n    const dedup = (ev) => {\n      if (!frame) {\n        permitNextChange = undefined;\n        events.clear();\n        frame = window.requestAnimationFrame(() => {\n          frame = null;\n          mergedEventHandler(events, permitNextChange);\n        });\n      }\n      ev && events.add(ev.type);\n    };\n\n    // lots of listeners for a million different change reasons\n    const rest = 'change keydown keypress focus click mousedown touchstart select input select-all select-end blur';\n    rest.split(/\\s+/).forEach((event) => el.addEventListener(event, dedup, {passive: true}));\n    dedup();\n\n    // handle 'suggest' event: show default autocomplete option\n    el.addEventListener('suggest', (ev) => {\n      suggest = ev.detail;\n      if (hasPendingSpace) {\n        maybeReplace();\n      }\n      dedup();\n    });\n\n    // if a user is dragging around, this might be changing the offsetLeft (dragging input l/r)\n    el.addEventListener('mousemove', (ev) => {\n      if (ev.which) {\n        dedup();\n      }\n    });\n\n    // add 'selectionchange' (only valid on document) to listen to the initial long-press selection\n    // on Chrome (possibly others?) mobile: it doesn't generate 'select'.\n    document.addEventListener('selectionchange', (ev) => {\n      if (document.activeElement === el) {\n        dedup();\n      }\n    });\n  }());\n\n  function maybeReplace(expectSpace = false) {\n    if (el.selectionEnd < sel.to) {\n      // this was before the end of the selection, don't autocomplete\n      return false;\n    }\n\n    const text = el.dataset['prefix'] || '';\n    if (text.length === 0 || !suggest || !suggest.name.startsWith(text)) {\n      // no valid sugestion or no text anyway\n      return false;\n    }\n\n    const rest = el.value.substr(sel.to);\n    const mustBeSpace = rest.substr(0, el.selectionStart - sel.to);\n    const trimmed = mustBeSpace.trim();\n    if (trimmed.length !== 0) {\n      // this wasn't blank or space chars\n      return false;\n    } else if (expectSpace && !mustBeSpace.length) {\n      // there wasn't a space and we expected one\n      return false;\n    }\n\n    if (rest.trim().length !== 0 && suggest.name !== text) {\n      // we're not the end of the string, so only autocomplete if it's entirely typed\n      return false;\n    }\n\n    // dispatch change request on ourselves\n    ga('send', 'event', 'options', 'typing');\n    const detail = {\n      choice: suggest.emoji,\n      word: suggest.name,\n    };\n    typer.dispatchEvent(new CustomEvent('emoji', {detail}));\n    return true;\n  }\n\n  // add a non-deduped keydown handler, to run before others and intercept space\n  el.addEventListener('keydown', (ev) => {\n    hasPendingSpace = false;\n    switch (ev.key) {\n    case 'Escape':\n      permitNextChange = false;  // force next change\n      break;\n\n    case 'ArrowDown':\n    case 'Down':\n    case 'ArrowUp':\n    case 'Up':\n      ev.preventDefault();  // disable normal up/down behavior to change focus\n      return;\n\n    case ' ':\n      const success = maybeReplace();\n      if (ev.shiftKey) {\n        ev.preventDefault();  // don't type space if shift held\n      }\n      if (!success) {\n        // hold this for when autocompletes arrive\n        hasPendingSpace = true;\n      }\n      break;\n    }\n  });\n\n  // add a non-deduped keyup handler, for space on mobile browsers ('dreaded keycode 229')\n  el.addEventListener('keyup', (ev) => {\n    // was it a 229 or no code, and was the typed character a space?\n    if (ev.keyCode === 229 || !ev.keyCode) {\n      // TODO: possibly record hasPendingSpace for future arriving suggestions\n      maybeReplace(true);\n    }\n  });\n\n  // dedup re-rendering calls\n  (function() {\n    let frame;\n    const dedupRenderLine = () => {\n      if (!frame) {\n        frame = window.requestAnimationFrame(() => {\n          frame = null;\n          renderLine();\n        });\n      }\n    };\n    window.addEventListener('resize', dedupRenderLine);\n    el.addEventListener('wheel', dedupRenderLine, {passive: true});\n  }());\n\n  // replace helper\n  const replaceFocus = (call) => {\n    const previousScrollLeft = el.scrollLeft;\n    const {from, to} = sel;\n    const value = el.value.substr(from, to - from);\n    let [start, end] = [typer.selectionStart, typer.selectionEnd];\n    const dir = typer.selectionDirection;\n\n    const update = call(value);\n    if (update == null) { return false; }\n\n    const prev = document.activeElement;\n\n    // select the region and 'type' it with insertText to provide undo/redo history\n    // nb. selecting the typer means that undo will always make us selected; probably fine\n    typer.focus();\n    typer.selectionStart = from;\n    typer.selectionEnd = to;\n    const expected = typer.value.substr(0, from) + update + typer.value.substr(to);\n    if (!document.execCommand('insertText', false, update) || typer.value !== expected) {\n      // set manually: this is fallback / Firefox mode\n      typer.value = typer.value.substr(0, from) + update + typer.value.substr(to);\n    }\n    typer.dispatchEvent(new CustomEvent('change'));  // nb. updates from/to (from won't change)\n\n    const drift = (where) => {\n      if (where >= to) {\n        // after the update\n        where = where - (to - from) + update.length;\n      } else if (where > from) {\n        // during the update\n        where = from + update.length;\n      } else {\n        // do nothing, was before\n      }\n      return where;\n    };\n\n    // pretend we were like this all along\n    [state.start, state.end] = [drift(start), drift(end)];\n    typer.setSelectionRange(state.start, state.end, dir);\n\n    // TODO(samthor): Safari refuses to make this focus after the first above.\n    prev && prev.focus();\n\n    permitNextChange = true;\n    el.scrollLeft = previousScrollLeft;  // before setRange, so the underline is correct\n    setRange(from, from + update.length);\n    return true;\n  };\n\n  // handle 'modifier' event: apply modifiers to the focus emoji, if any\n  el.addEventListener('modifier', (ev) => {\n    const arg = {[ev.detail.type]: ev.detail.code};\n    replaceFocus((value) => modifier.modify(value, arg).out);\n  });\n\n  // handle 'emoji' event: if there's a current focus word, then replace it with the new emoji \\o/\n  el.addEventListener('emoji', (ev) => {\n    const emoji = ev.detail.choice;\n    if (!replaceFocus(() => emoji)) { return; }\n\n    // listen to the caller's view on what word we should pretend this emoji is\n    el.dataset['word'] = ev.detail.word || '';\n    datasetSafeDelete(el, 'prefix');\n  });\n}\n\nupgrade(typer);\n","\nconst resolved = Promise.resolve();\n\n/**\n * Returns a Promise that resolves on `requestIdleCallback`.\n *\n * @return {!Promise<!IdleDeadline>}\n */\nexport function idle() {\n  return new Promise((resolve) => window.requestIdleCallback(resolve));\n}\n\n/**\n * Returns a Promise that resolves on `requestAnimationFrame`.\n *\n * @param {number=} delay whether to also delay by `setTimeout`\n * @return {!Promise<!IdleDeadline>}\n */\nexport function rAF(delay=undefined) {\n  if (delay !== undefined) {\n    return new Promise((resolve) => {\n      window.setTimeout(() => window.requestAnimationFrame(resolve), delay);\n    });\n  }\n  return new Promise((resolve) => window.requestAnimationFrame(resolve));\n}\n\n/**\n * Returns a Promise that resolves after a microtask.\n *\n * @return {!Promise<void>}\n */\nexport function microtask() {\n  return Promise.resolve();\n}\n\n/**\n * @return {{promise: !Promise<void>, resolver: function(): void}}\n */\nexport function resolver() {\n  let resolver;\n  const promise = new Promise((resolve) => resolver = resolve);\n  return {resolver, promise};\n}\n\n/**\n * @return {!Promise<void>}\n */\nexport function delay(ms=0) {\n  return new Promise((resolve) => window.setTimeout(resolve, ms));\n}\n\nconst debouceMap = new Map();\n\n/**\n * Returns a Promise that debounces a call to the passed callable.\n *\n * @template T\n * @param {function(): T} callable\n * @param {number=} delay\n * @return {!Promise<T>}\n */\nexport function debounce(callable, delay=0) {\n  let state = debouceMap.get(callable);\n  if (!state) {\n    state = {c: callable};\n    const p = new Promise((resolve) => state.r = resolve);\n    state.p = p.then(() => {\n      debouceMap.delete(callable);\n      return state.c();\n    });\n    debouceMap.set(callable, state);\n  }\n\n  window.clearTimeout(state.t);\n  state.t = window.setTimeout(state.r, Math.max(0, delay));\n\n  return state.p;\n}","\n/**\n * Remove duplicate entries from the passed array, only from the 1th index.\n *\n * @param {!Array<string>}\n * @return {!Array<string>}\n */\nfunction removeDuplicates(row) {\n  const found = new Set();\n  return row.filter((item, i) => {\n    if (i !== 0) {\n      if (found.has(item)) { return false; }\n      found.add(item);\n    }\n    return true;\n  });\n}\n\n/**\n * Merge the given results arrays. These will both be in the form of:\n *   [[name, emoji1, emoji2,....], ...]\n *\n * The first argument will be updated with the data from the following arguments.\n *\n * @param {...!Array<!Array<string>>} all\n */\nexport function merge(...all) {\n  if (!all.length) {\n    return [];\n  }\n\n  const lookup = {};\n  const existing = all.shift();\n  existing.forEach((row, i) => lookup[row[0]] = i);\n\n  all.forEach((update) => {\n    update.forEach((row) => {\n      const index = lookup[row[0]];\n      if (index === undefined) {\n        lookup[row[0]] = existing.length;  // in case there's dup data\n        existing.push(row);\n        return;\n      }\n  \n      // otherwise, just append all new data and place back into array\n      const existingRow = existing[index];\n      const updatedData = row.slice(1);\n      existing[index] = removeDuplicates(existingRow.concat(updatedData));\n    });\n  });\n\n  return existing;\n}","const options = {\n  'abcd': [0x1f521],\n  'abc': [0x1f524],\n  'ab': [0x1f18e],\n  'a': [0x1f170, 0xfe0f],\n  'atm': [0x1f3e7],\n  'cool': [0x1f192],\n  'free': [0x1f193],\n  'id': [0x1f194],\n  'i': [0x2139, 0xfe0f],\n  'm': [0x24c2, 0xfe0f],\n  'ok': [0x1f197],\n  'o': [0x1f17e, 0xfe0f],\n  'p': [0x1f17f, 0xfe0f],\n  'sos': [0x1f198],\n  'up': [0x1f199],\n  'vs': [0x1f19a],\n  '!!': [0x203c, 0xfe0f],\n  '!?': [0x2049, 0xfe0f],\n  '!': [0x2757],\n  '?': [0x2753],\n  '$': [0x1f4b2],\n  '': [0x1f4b7],\n  '': [0x1f4b6],  // FIXME: emojityper doesn't think this is a word char\n  '': [0x1f4b4],\n  'new': [0x1f195],\n  'ng': [0x1f196],\n  'zzz': [0x1f4a4],\n  '1234': [0x1f522],\n  'cl': [0x1f191],\n  'b': [0x1f171, 0xfe0f],\n  'wc': [0x1f6be],\n  '100': [0x1f4af],\n  '10': [0x1f51f],\n  '*': [0x2a, 0xfe0f, 0x20e3],\n  '#': [0x23, 0xfe0f, 0x20e3],\n// \"tm\" is a bit subtle\n//  'tm': [0x2122, 0xfe0f],\n  '<': [0x25c0, 0xfe0f],\n  '>': [0x25b6, 0xfe0f],\n  '^': [0x1f53c],\n  '+': [0x2795],\n  '-': [0x2796],\n  'x': [0x274e],\n  '~': [0x3030, 0xfe0f],\n  '.': [0x23fa, 0xfe0f],\n};\n\n\nconst keys = Object.keys(options);\nkeys.sort((a, b) => {\n  if (a.length !== b.length) {\n    return b.length - a.length;\n  }\n  if (a < b) {\n    return -1;\n  } else if (a > b) {\n    return +1;\n  }\n  return 0;\n});\n\n\nconst matchPrefix = (s, preferLetter) => {\n  let cand = null;\n\n  if (s[0] >= 'a' && s[0] <= 'z') {\n    const point = 0x1f1e6 + (s.codePointAt(0) - 97);\n    cand = {length: 1, points: [point, 0xfe0f]};\n  } else if (s[0] >= '0' && s[0] <= '9') {\n    const point = 0x30 + (s.codePointAt(0) - 48);\n    cand = {length: 1, points: [point, 0xfe0f, 0x20e3]};\n  }\n\n  if (preferLetter && cand) {\n    return cand;\n  }\n\n  for (const k of keys) {\n    if (s.startsWith(k)) {\n      return {length: k.length, points: options[k]};\n    }\n  }\n  return cand;\n};\n\n\nexport default function(value, preferLetter=false) {\n  let work = value.toLowerCase();\n  const out = [];\n\n  while (work.length) {\n    const matched = matchPrefix(work, preferLetter);\n    if (matched === null) {\n      return null;  // fail early, can't emoji-fy this\n    }\n    out.push(...matched.points);\n    work = work.substr(matched.length);\n  }\n\n  return String.fromCodePoint(...out);\n}","const api = 'https://emojibuff.com/api';\nconst recentLimit = 16;\nconst selectionDelay = 5 * 1000;\n\nimport build from './prefixgen.js';\nimport * as promises from './promises.js';\nimport * as results from './results.js';\nimport type from './type.js';\n\n/**\n * @param {string} key for endpoint/cache\n * @param {number} expiry in hours\n * @param {(function(boolean): void)=} callback to call with true then false (for loading work)\n * @return {function(): !Promise<!Array<!Array<string>>}\n */\nfunction loaderFor(key, expiry=24, callback=() => {}) {\n  let promiseResults;\n\n  // TODO: refetch after >expiry, don't just invalidate\n\n  const raw = window.localStorage[key];\n  if (raw) {\n    let out;\n    try {\n      out = JSON.parse(raw);\n    } catch (e) {\n      console.debug('couldn\\'t parse localStorage', key, e);\n      out = null;\n    }\n    if (out && out['results']) {\n      promiseResults = Promise.resolve(out['results']);\n      if (out['created'] >= +new Date - (60 * 60 * 1000 * expiry)) {\n        // return immediately, it's less than one day old\n        return () => promiseResults;\n      }\n    }\n  }\n\n  // we don't have data or it's >1day old, refetch\n  // TODO(samthor): Break into retryable fetch.\n  const f = new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    xhr.open('GET', `${api}/${key}`);\n    xhr.onerror = reject;\n    xhr.responseType = 'json';\n    xhr.onload = () => resolve(xhr.response);\n    xhr.send();\n  }).then((raw) => {\n    // IE11 doesn't respect responseType, and we always return an Object\n    return typeof raw === 'string' ? JSON.parse(raw) : raw;\n  }).then((update) => {\n    promiseResults = f;  // can return real results now\n\n    // store in localStorage for next time\n    update['created'] = +new Date();\n    window.localStorage[key] = JSON.stringify(update);\n\n    // return updated results\n    return update['results'];\n  });\n\n  // no local data, wait for data\n  if (!promiseResults) {\n    callback(true);                 // indicate working\n    f.then(() => callback(false));  // done\n    return () => f;\n  }\n\n  return () => promiseResults;\n}\n\n/**\n * Returns the local prefix search tool.\n *\n * @return {!Promise<function(string, boolean): !Array<!Array<string>>>}\n */\nconst getPrefixGen = (function() {\n  const loader = loaderFor('popular', 24, (working) => {\n    // TODO: It's a bit ugly to hit the loader from here.\n    window.loader.hidden = !working;\n  });\n  return () => {\n    return loader().then((results) => build(results))\n  };\n}());\n\n/**\n * Returns the trending emoji.\n *\n * @return {!Promise<!Array<string>>}\n */\nconst getTrendingEmoji = (function() {\n  const loader = loaderFor('hot', 1);\n  return () => {\n    return loader().then((results) => {\n      let out = [];\n      results.forEach((data) => {\n        out = out.concat(data.slice(1));  // drop name\n      });\n      return out;\n    });\n  };\n}());\n\n/**\n * Requests emoji completion.\n *\n * @param {string} text user has typed\n * @param {boolean} prefix is this a prefix search, or is it a definite whole word?\n * @param {boolean=} more whether to return lots more results for this query\n * @return {!Promise<!Array<!Array>>}\n */\nexport function request(text, prefix, more=false) {\n  if (!text) {\n    if (more && text === '') {\n      const r = recent();\n      r.unshift('^recent');\n\n      return getTrendingEmoji().then((p) => {\n        p.unshift('^trending');\n        return [r, p];\n      });\n    }\n\n    return Promise.resolve([]);\n  }\n\n  const all = [\n    getPrefixGen().then((suggest) => suggest(text, prefix)),\n  ];\n\n  if (more) {\n    // TODO: At some point, the 'more' data should go into a local cache. For now, just fetch.\n    let url = `${api}/q?q=${window.encodeURIComponent(text)}`;\n    if (!prefix) {\n      url += '&exact';\n    }\n    const morePromise = window.fetch(url).then((out) => out.json()).then((out) => out['results']);\n    all.push(morePromise);\n  }\n\n  const typer = type(text);\n  const typerLetter = type(text, true);\n  if (typer || typerLetter) {\n    const r = ['^type'];\n    if (typer) {\n      r.push(typer);\n    }\n    if (typerLetter && typerLetter !== typer) {\n      r.push(typerLetter);\n    }\n    all.push([r]);\n  }\n\n  return Promise.all(all).then((out) => results.merge(...out));\n}\n\n/**\n * Records use of name/emoji pairs.\n *\n * @param {string} name used to select emoji\n * @param {string} emoji selected\n * @param {!Promise<!Response>} eventual response after delay\n */\nexport const select = (function() {\n  let pending = {};\n\n  const runner = () => {\n    const body = JSON.stringify(pending);\n    pending = {};  // clear pending for next time\n    return navigator.sendBeacon(api + '/sel', body);\n  };\n\n  return function select(name, emoji) {\n    if (name[0] === '^') {\n      return;  // do nothing\n    }\n\n    const r = recent();\n    const index = r.indexOf(emoji);\n    if (index !== -1) {\n      r.splice(index, 1);\n    }\n    r.unshift(emoji);\n    r.splice(recentLimit);\n    window.localStorage['recent'] = r.join(',');\n    // TODO: do something with recent emoji use\n\n    pending[name] = emoji;\n    return promises.debounce(runner, selectionDelay);\n  }\n}());\n\n/**\n * Submit the name of an emoji.\n *\n * @param {string} name\n * @param {string} emoji\n * @return {!Promise<Response>}\n */\nexport function submit(name, emoji) {\n  const body = new FormData();\n  body.append('name', name);\n  body.append('emoji', emoji);\n  return window.fetch(api + '/name', {method: 'POST', mode: 'cors', body});\n}\n\n/**\n * Gets recently used emoji.\n *\n * @return {!Array<string>}\n */\nexport function recent() {\n  return (window.localStorage['recent'] || '').split(',').filter((x) => x);\n}","\nexport default function build(raw, prefixLength=3, maxSuggestions=10) {\n  const prefixSuggest = {};\n\n  const values = {};\n  raw.forEach(data => {\n    const k = data[0];\n    values[k] = data.slice(1);\n\n    const prefix = k.substr(0, prefixLength);\n    for (let i = 1; i <= prefix.length; ++i) {\n      const part = prefix.substr(0, i);\n      let opts = prefixSuggest[part];\n      if (!opts) {\n        opts = prefixSuggest[part] = [];\n      }\n      if (opts.length < maxSuggestions) {\n        opts.push(k);\n      }\n    }\n  });\n\n  return function(typed, prefix) {\n    typed = typed.toLowerCase();\n    const rest = typed.substr(prefixLength);\n    let all = prefixSuggest[typed.substr(0, prefixLength)] || [];\n\n    if (rest) {\n      all = all.filter(word => word.substr(prefixLength).startsWith(rest));\n    }\n    if (!prefix) {\n      all = all.filter(word => word === typed);\n    }\n    all = all.map(word => [word, ...values[word]]);\n\n    return all.length ? all : [];\n  }\n}\n","\n/**\n * @fileoverview Async worker.\n */\n\nimport * as promises from './promises.js';\n\nconst allowedWorkTime = 4;\nconst maximumTaskFrame = 100;\n\nexport default class Worker {\n  constructor(fn) {\n    this.fn_ = fn;\n    this.queue_ = [];\n    this.waiting_ = null;\n\n    this.runner_().catch((err) => {\n      console.info('worker runner failed', err);\n      throw err;\n    });\n  }\n\n  async runner_() {\n    await new Promise((resolve) => this.waiting_ = resolve);\n    this.waiting_ = null;\n    await promises.idle();\n\n    for (;;) {\n      if (this.chunk_()) {\n        return this.runner_();\n      }\n      await promises.rAF();\n    }\n  }\n\n  /**\n   * Completes a chunk of work.\n   *\n   * @return {boolean} Whether work is done.\n   */\n  chunk_() {\n    const start = window.performance.now();\n\n    let done = 0;\n    while (this.queue_.length) {\n      const next = this.queue_.shift();\n      next.resolve(this.fn_(next.arg));\n      ++done;\n\n      if (done == maximumTaskFrame || window.performance.now() - start > allowedWorkTime) {\n        break;\n      }\n    }\n\n    return !this.queue_.length;\n  }\n\n  task(arg) {\n    return new Promise((resolve) => {\n      this.queue_.push({resolve, arg});\n      this.waiting_ && this.waiting_();\n    });\n  }\n}\n","\n/**\n * @fileoverview The validator runs constantly and validates emoji rendering.\n */\n\nimport {isExpectedLength} from '../../node_modules/ok-emoji/src/measurer.js';\nimport Worker from './worker.js';\n\nconst dummyString = 'a';  // change if we mess something up\n\nconst prefix = '-ok_';\nconst ls = window.localStorage;\nconst known = new Map();\n\nconst ignoreValid = (window.location.search.indexOf('ignore_valid') !== -1);\n\nfunction runner(emoji) {\n  // nb. Helper code for detecting text-only results from backend.\n  if (emoji.charCodeAt(0) === 0x200b) {\n    return true;\n  }\n  const out = isExpectedLength(emoji);\n  known.set(emoji, out);\n  if (out) {\n    ls[prefix + emoji] = dummyString;  // use dummy small string\n  }\n  return out;\n}\n\nconst worker = new Worker(runner);\nconst task = ignoreValid ? () => true : worker.task.bind(worker);\n\nfunction immediate(emoji) {\n  const immediate = known.get(emoji);\n  if (immediate !== undefined) {\n    return immediate;\n  }\n  if (ls[prefix + emoji] === dummyString) {\n    return true;\n  }\n  return undefined;\n}\n\n/**\n * As per isExpectedLength, but caches successful results.\n *\n * @param {string} string to check\n * @return {!Promise<boolean>} whether this is probably an emoji\n */\nexport async function valid(emoji) {\n  const result = immediate(emoji);\n  if (result !== undefined) {\n    return result;\n  }\n  return task(emoji);\n}\n\n/**\n * Async helper that finds the first valid autocomplete option. Uses a callback in order to hint\n * whether the result is coming in the current frame (before any await) or after (calls callback\n * with null first).\n *\n * @param {!Array<!Array<string>>} options\n * @param {function(?{name: string, emoji: string})} callback\n */\nexport async function findValidMatch(options, callback) {\n  let calledWithDelay = false;\n\n  for (let i = 0; i < options.length; ++i) {\n    const row = options[i];\n    for (let j = 1; j < row.length; ++j) {\n      const emoji = row[j];\n      let result = immediate(emoji);\n      if (result === undefined) {\n        // we have to wait for the runner, so call with a delay\n        if (!calledWithDelay) {\n          callback(null);\n          calledWithDelay = true;\n        }\n        result = await task(emoji);\n      }\n\n      if (result) {\n        return callback({name: row[0], emoji});\n      }\n    }\n  }\n\n  if (!calledWithDelay) {\n    callback(null);\n  }\n}\n","\n/**\n * @fileoverview Emojityper's suggestion handler. Handles creation, showing etc of autocomplete\n * buttons in the UI.\n */\n\nimport * as provider from './lib/provider.js';\nimport * as modifier from './lib/modifier.js';\nimport {valid, findValidMatch} from './lib/valid.js';\nimport * as promises from './lib/promises.js';\nimport * as eventlib from './lib/event.js';\nimport * as input from './input.js';\nimport * as copier from './lib/copier.js';\n\n/**\n * ButtonManager helps create and show emoji buttons in the UI.\n */\nclass ButtonManager {\n  constructor(holder) {\n    this.holder_ = holder;\n\n    /** @type {!Map<string, !HTMLElement>} */\n    this.options_ = new Map();\n\n    /** @type {!Map<string, !HTMLButtonElement>} */\n    this.buttons_ = new Map();\n\n    /** @type {!WeakMap<!HTMLButtonElement, !DocumentFragment>} */\n    this.buttonTarget_ = new WeakMap();\n\n    /** @type {!Array<!HTMLButtonElement} */\n    this.buttonPool_ = [];\n\n    window.requestIdleCallback(() => {\n      for (let i = 0; i < 10; ++i) {\n        this.buttonPool_.push(document.createElement('button'));\n      }\n    });\n\n    const modifierHolder = document.createElement('div');\n    this.holder_.appendChild(modifierHolder);\n\n    /** @type {function(this:ButtonManager, !Object): void} */\n    this.setModifier = (() => {\n      const genderOption = ButtonManager.optionType_('modifier', 'gender');\n      const toneOption = ButtonManager.optionType_('modifier', 'tone');\n      modifierHolder.appendChild(genderOption);\n      modifierHolder.appendChild(toneOption);\n\n      // helper to create buttons\n      const createModifierButton = (text, value=null) => {\n        const button = document.createElement('button');\n        button.textContent = text;\n        button.dataset['value'] = value;\n        return button;\n      };\n\n      // create gender options\n      const genders = [\n        createModifierButton('\\u{26AC}', ''),\n        createModifierButton('\\u{2640}', 'f'),\n        createModifierButton('\\u{2640}\\u{2642}', 'fm'),\n        createModifierButton('\\u{2642}', 'm'),\n        createModifierButton('\\u{2642}\\u{2640}', 'mf'),\n      ];\n\n      // create tone options\n      const tones = [\n        createModifierButton('\\u{2014}', ''),\n      ];\n      for (let i = 0x1f3fb; i <= 0x1f3ff; ++i) {\n        tones.push(createModifierButton(String.fromCodePoint(i), i));\n      }\n\n      // helper to add/remove\n      const updateStatus = (yes, node, owner) => {\n        yes ? owner.appendChild(node) : node.remove();\n      };\n      return function(info) {\n        const active =\n            modifierHolder.contains(document.activeElement) ? document.activeElement : null;\n        genders.forEach((node) => {\n          const l = node.dataset['value'].length;\n          const yes = (!l && info.gender.neutral)\n              || (l === 1 && info.gender.single)\n              || (l === 2 && info.gender.double);\n          updateStatus(yes, node, genderOption);\n        });\n        tones.forEach((node) => updateStatus(info.tone, node, toneOption));\n\n        // kick the elements: Safari needs this otherwise sometimes they remain hidden (!)\n        modifierHolder.insertBefore(genderOption, genderOption.nextSibling);\n        modifierHolder.insertBefore(toneOption, toneOption.nextSibling);\n\n        // refocus if one was focused\n        active && active.focus();\n      }\n    })();\n  }\n\n  static optionType_(type, value) {\n    const node = document.createElement('div');\n    node.className = 'options ' + type;\n    node.dataset[type] = value;\n    node.dataset['name'] = value;\n    return node;\n  }\n\n  optionForName_(name) {\n    const prev = this.options_.get(name);\n    if (prev) {\n      return prev;\n    }\n    const node = document.createElement('div');\n    node.className = 'options';\n    node.setAttribute('data-option', name);\n\n    if (name[0] === '^') {\n      node.classList.add('special');\n      name = name.substr(1);\n    }\n    node.setAttribute('data-name', name);  // presentation only\n    return node;\n  }\n\n  /**\n   * Creates a `button` with the textContent of the passed emoji. Starts removed from the page,\n   * but will (when valid) be placed in-order inside the specified `option`.\n   *\n   * @param {!HTMLElement} option to place inside\n   * @param {string} emoji\n   * @return {!HTMLButtonElement}\n   */\n  addEmojiTo_(option, emoji) {\n    let button = this.buttons_.get(emoji);\n    if (button) {\n      // if the button was known, check buttonTarget_: either it's the eventual placement, which\n      // we must replace, or it's a known good/bad already\n      const target = this.buttonTarget_.get(button);\n      if (target === null) {\n        return button;  // known invalid\n      } else if (target === undefined) {\n        option.appendChild(button);  // known good\n        return button;\n      }\n    } else {\n      button = this.buttonPool_.pop() || document.createElement('button');\n      button.textContent = emoji;\n      this.buttons_.set(emoji, button);\n\n      valid(emoji).then((isValid) => {\n        if (!isValid) {\n          return this.buttonTarget_.set(button, null);\n        }\n\n        const node = this.buttonTarget_.get(button);\n        if (!node) {\n          return;  // we were GC'ed before valid returned\n        }\n        node.parentNode.replaceChild(button, node);\n        this.buttonTarget_.delete(button);\n      });\n    }\n\n    const node = document.createTextNode('');  // empty placeholder to replace\n    this.buttonTarget_.set(button, node);\n    option.appendChild(node);\n\n    return button;\n  }\n\n  /**\n   * Updated displayed options with real results. These are expected the API format:\n   *    [[name,emoji,emoji,...],[name,emoji,...],...]\n   *\n   * This retains existing options if they are included in the named results.\n   *\n   * @param {!Array<!Array<string>>}\n   */\n  update(results) {\n    const options = new Map();\n    const buttons = new Map();\n    const previousActiveElement =\n        this.holder_.contains(document.activeElement) ? document.activeElement : null;\n\n    results.forEach((result) => {\n      const name = result[0];\n      const special = (name[0] === '^');\n\n      const option = this.optionForName_(name);\n      options.set(name, option);\n      this.options_.delete(name);\n      this.holder_.appendChild(option);  // reinsert in better order\n\n      // TODO(samthor): This is a bit hacky. This saves buttons that are part of these options,\n      // even if they haven't been sent to us again in results.\n      for (let i = 0; i < option.children.length; ++i) {\n        const b = option.children[i];\n        const emoji = b.textContent;\n        if (special || buttons.has(emoji)) {\n          b.remove();\n          this.buttonPool_.push(b);\n          --i;\n          continue;\n        }\n        buttons.set(emoji, b);\n      }\n\n      for (let i = 1, emoji; emoji = result[i]; ++i) {\n        if (buttons.has(emoji)) {\n          continue;  // already displayed by an option before us\n        }\n        // nb. addEmojiTo_ pulls old buttons from this.buttons_\n        buttons.set(emoji, this.addEmojiTo_(option, emoji));\n      }\n    });\n\n    // remove now-disused options\n    this.options_.forEach((option) => {\n      // TODO(samthor): Edge doesn't like ...HTMLCollection\n      for (let i = 0; i < option.children.length; ++i) {\n        this.buttonPool_.push(option.children[i]);\n      }\n      option.remove();\n    });\n    this.options_ = options;\n    this.buttons_ = buttons;\n\n    if (previousActiveElement) {\n      if (document.body.contains(previousActiveElement)) {\n        previousActiveElement.focus();\n      } else {\n        typer.focus();  // restore to main input\n      }\n    }\n  }\n}\n\n// key overrides to recognize spacebar causing 'click'\nlet spaceFrame = 0;\nchooser.addEventListener('keyup', (ev) => {\n  if (ev.key !== ' ' || ev.target.localName !== 'button') { return; }\n  spaceFrame = window.setTimeout(() => spaceFrame = 0, 0);\n});\n\n// stores the previous user-driven l/r position\nlet previousChooserLeft = undefined;\nlet duringNavigate = false;\n\n// if a button was focused, reset chooser unless we were going u/d\nchooser.addEventListener('focus', (ev) => {\n  if (!duringNavigate) {\n    previousChooserLeft = document.activeElement.getBoundingClientRect().left;\n  }\n}, true);\n\n/**\n * Navigates through candidates until we find the best not on our current row, and focuses it.\n *\n * @param {!IArrayLike<!Node>} cands\n * @return {boolean} true if we focused something new\n */\nfunction navigateChooserButtonVertical(cands) {\n  const best = {dist: Infinity, button: null};\n\n  const previousRect = document.activeElement.getBoundingClientRect();\n  // did we have a previous explicit l/r position?\n  const left = (previousChooserLeft !== undefined ? previousChooserLeft : previousRect.left);\n\n  let targetTop = undefined;\n  for (let i = 0; i < cands.length; ++i) {\n    const button = cands[i];\n    const candidateRect = button.getBoundingClientRect();\n\n    if (previousRect.top === candidateRect.top) { continue; }\n    if (targetTop === undefined) {\n      targetTop = candidateRect.top;\n    } else if (candidateRect.top !== targetTop) {\n      break;  // no more good candidates\n    }\n\n    const dist = Math.abs(candidateRect.left - left);\n    if (dist < best.dist) {\n      [best.dist, best.button] = [dist, button];\n    }\n  }\n\n  if (!best.button) {\n    return false;\n  }\n  duringNavigate = true;\n  try {\n    best.button.focus();\n  } finally {\n    duringNavigate = false;\n  }\n  return true;\n}\n\n// button click handler\nchooser.addEventListener('click', (ev) => {\n  previousChooserLeft = undefined;  // used a mouse or chose something\n  const isKeyboard = eventlib.isKeyboardClick(ev);\n\n  let label = undefined;\n  const b = ev.target;\n  if (b.localName !== 'button') {\n    // ignore\n  } else if (b.parentNode.dataset['modifier']) {\n    if (ev.shiftKey) {\n      return;  // don't do anything\n    }\n\n    const value = 'value' in b.dataset ? (+b.dataset['value'] || b.dataset['value']) : null;\n    const detail = {type: b.parentNode.dataset['modifier'], code: value};\n    typer.dispatchEvent(new CustomEvent('modifier', {detail}));\n    label = 'modifier';\n  } else if (b.parentNode.dataset['option']) {\n    if (ev.shiftKey) {\n      if (copier.copyText(b.textContent)) {\n        ga('send', 'event', 'options', 'copy');\n      }\n\n      // retain scroll position while refocusing on the suitable target\n      const scrollTop = document.scrollingElement.scrollTop;\n      isKeyboard ? b.focus() : typer.focus();\n      document.scrollingElement.scrollTop = scrollTop;\n      return;\n    }\n\n    // nb. we typically clear the word on choice (as it confuses @nickyringland), but if you hit\n    // space or ctrl-click the button, keep it around.\n    const retainWord = (spaceFrame !== 0 || ev.metaKey || ev.ctrlKey);\n    const word = retainWord ? b.parentNode.dataset['option'] : null;\n\n    const detail = {choice: b.textContent, word};\n    typer.dispatchEvent(new CustomEvent('emoji', {detail}));\n    provider.select(b.parentNode.dataset['option'], detail.choice);\n    label = 'emoji';\n  } else {\n    // unknown\n  }\n  if (!label) { return; }\n\n  ga('send', 'event', 'options', 'click', label);\n\n  if (!isKeyboard) {\n    typer.focus();  // nb. we're actually double-refocusing\n  }\n});\n\n// handle moving down from input\ntyper.addEventListener('keydown', (ev) => {\n  if (ev.key === 'ArrowDown' || ev.key === 'Down') {\n    const typerRect = typer.getBoundingClientRect();\n    previousChooserLeft = typerRect.left + input.cursorPosition(typer);\n\n    if (navigateChooserButtonVertical(chooser.querySelectorAll('button'))) {\n      ga('send', 'event', 'options', 'keyboardnav');\n    }\n  } else if (ev.key === 'ArrowRight' || ev.key === 'Right') {\n    const l = typer.value.length;\n    if (typer.selectionEnd === l && typer.selectionStart === l) {\n      const first = chooser.querySelector('button');\n      first && first.focus();\n    }\n  }\n});\n\n// handle keyboard navigation inside chooser\nchooser.addEventListener('keydown', (ev) => {\n  const arrow = eventlib.arrowFromEvent(ev);\n  if (!arrow) { return; }\n\n  if (!chooser.contains(document.activeElement)) { return; }\n\n  // TODO: memoize value\n  const buttonArray = Array.from(chooser.querySelectorAll('button'));\n  const index = buttonArray.indexOf(document.activeElement);\n  if (index === -1) { return; }\n\n  // handle l/r keys\n  let delta;\n  if (arrow === 'ArrowLeft') {\n    delta = -1;\n  } else if (arrow === 'ArrowRight') {\n    delta = +1;\n  }\n  if (delta) {\n    const target = index + delta;\n    if (target >= 0 && target < buttonArray.length) {\n      buttonArray[target].focus();\n    } else if (target < 0) {\n      typer.focus();\n      typer.dispatchEvent(new CustomEvent('select-end'));\n    }\n    return;  // done\n  }\n\n  // handle u/d keys\n  let cands;\n  if (arrow === 'ArrowUp') {\n    cands = buttonArray.slice(0, index);\n    cands.reverse();\n  } else if (arrow === 'ArrowDown') {\n    cands = buttonArray.slice(index);\n  } else {\n    return;\n  }\n\n  if (!navigateChooserButtonVertical(cands)) {\n    if (arrow === 'ArrowUp') {\n      typer.focus();\n    }\n  }\n  if (arrow === 'ArrowDown') {\n    // don't allow arrow scrolling unless we're within 64 pixels of the screen end\n    const focusRect = document.activeElement.getBoundingClientRect();\n    const max = focusRect.top + focusRect.height;\n    if (window.innerHeight - max > 64) {\n      ev.preventDefault();\n    }\n  }\n});\n\n(function() {\n  const longTime = 2000;\n  const delayTime = 250;\n  const manager = new ButtonManager(chooser);\n\n  let previous = {};\n  let previousQueryAt = performance.now();\n  let previousResults = [];\n\n  let suggestInvoke = 0;\n  function findSuggest(q) {\n    const localSuggestInvoke = ++suggestInvoke;\n    if (!q) {\n      typer.dispatchEvent(new CustomEvent('suggest', {detail: null}));\n      return;\n    }\n\n    let exactMatch = null;\n    const localResults = previousResults.slice().filter((row) => {\n      if (q.length > 1 && row[0] === q) {\n        exactMatch = row;\n        return false;\n      }\n      return row[0].startsWith(q) || row[0][0] === '^';\n    });\n    exactMatch && localResults.unshift(exactMatch);\n\n    const callback = (result) => {\n      if (localSuggestInvoke === suggestInvoke) {\n        typer.dispatchEvent(new CustomEvent('suggest', {detail: result}));\n      }\n    };\n    findValidMatch(localResults, callback);\n  }\n\n  // handler for a prefix search\n  typer.addEventListener('query', (ev) => {\n    const query = ev.detail;\n    const now = performance.now();\n\n    // immediately inform manager of modifier buttons (gender, tone), if it's a full word search\n    const info = modifier.modify(!ev.detail.prefix && ev.detail.focus || '');\n    manager.setModifier(info);\n\n    if (previous.text !== query.text) {\n      // text changed, immediately run suggest code\n      findSuggest(query.text);\n    }\n\n    // TODO(samthor): This delays further requests. Ideally we want to 'subscribe' to a topic\n    // from the provider and just be fed updates as fast as we have them (including if we have\n    // a local cache). This way we avoid awkward delays and filtering oddities.\n    const initialMore = previous.text && query.text && previous.text.length !== 0 &&\n        previous.text.startsWith(query.text.substr(0, previous.text.length)) || false;\n\n    let immediate = false;\n    if (!previous.text || previous.prefix !== query.prefix) {\n      immediate = true;  // type changed, user expects snappiness\n    } else if (now - previousQueryAt > longTime) {\n      immediate = true;  // it's been a while\n    }\n    previous = query;\n    previousQueryAt = now;\n\n    const request = async (timeout=0, more=false) => {\n      if (timeout) {\n        await promises.rAF(timeout);\n        if (previous !== query) { return -1; }\n      }\n      const results = await provider.request(query.text, query.prefix, more);\n      if (previous !== query) { return -1; }\n\n      // find the first matching thing and suggest it as autocomplete\n      previousResults = results;\n      findSuggest(query.text);\n\n      return manager.update(results);\n    };\n\n    const p = request(immediate ? 0 : delayTime, initialMore).then((valid) => {\n      if (valid < 0) { return -2; }  // query changed\n\n      if (!query.text) {\n        // TODO: delay empty data by a decent time, except on small screens\n        const timeout = window.innerHeight <= 400 ? 0 : 750;\n        return request(timeout, true);\n      }\n\n      const timeout = Math.max(1000, 100 * Math.pow(valid, 0.75));\n      return request(timeout, true);\n    }).catch((err) => {\n      console.error('error doing request', err);\n    });\n  });\n}());\n","\nimport * as provider from './lib/provider.js';\nimport * as promises from './lib/promises.js';\n\n// advanced handler\n(function(input, advanced) {\n  const form = advanced.querySelector('form');\n  const namer = form.querySelector('input');\n  const button = form.querySelector('button');\n\n  let value = '';\n  let pending = null;\n\n  input.addEventListener('query', (ev) => {\n    const query = ev.detail;\n    const selection = (query.text === null && query.focus !== undefined && query.selection);\n    value = query.focus;\n    if (!selection) {\n      if (!pending) {\n        namer.value = '';  // clear on done if not pending\n        advanced.hidden = true;\n      }\n      return false;\n    }\n    // TODO: round trip to confirm validity of emoji?\n    advanced.hidden = false;\n  });\n\n  const handler = ev => {\n    button.disabled = !namer.value;\n  };\n  'input change'.split(/\\s+/).forEach(type => namer.addEventListener(type, handler));\n\n  form.addEventListener('submit', (ev) => {\n    ev.preventDefault();\n    if (pending) {\n      return false;  // can't submit while running\n    }\n\n    form.classList.add('pending');\n    namer.disabled = true;\n    button.disabled = true;\n\n    const cleanup = _ => {\n      form.classList.remove('pending');\n      namer.disabled = false;\n      namer.value = '';\n      namer.dispatchEvent(new CustomEvent('change'));\n\n      pending = null;\n      if (!value) {\n        advanced.hidden = true;\n      }\n    };\n\n    pending = provider.submit(namer.value, value).then((response) => {\n      if (!response.ok) {\n        throw new Error(response.status);\n      }\n      button.classList.add('success');\n      return false;\n    }).catch(err => {\n      button.classList.add('failure');\n      console.warn('failed to submit emoji', err);\n      return true;\n    }).then(cleanup);\n\n    pending.then(() => promises.delay(2000)).then(() => {\n      button.className = '';\n    });\n  });\n}(typer, advanced));\n","\n/**\n * @fileoverview Controls the size and `has-value` class of the body itself based on current input.\n */\n\nimport * as promises from './lib/promises.js';\n\nconst value = (ev) => {\n  const text = ev.detail.trim();\n  document.body.classList.toggle('has-value', Boolean(text));\n};\ntyper.addEventListener('value', value);\nvalue({detail: typer.value});\n\n// global return-to-typer\ndocument.body.addEventListener('keydown', (ev) => {\n  switch (ev.key) {\n  case 'Escape':\n    // #1: focus on typer\n    if (document.activeElement !== typer) {\n      typer.focus();\n      break;\n    }\n\n    // #2: clear selection\n    if (typer.selectionStart !== typer.selectionEnd) {\n      if (typer.selectionDirection === 'backward') {\n        typer.selectionStart = typer.selectionEnd;\n      } else {\n        typer.selectionEnd = typer.selectionStart;\n      }\n      break;\n    }\n\n    // #3: move to end of input\n    const l = typer.value.length;\n    typer.setSelectionRange(l, l);\n    break;\n  }\n});\n\nfunction isExtentNode(node) {\n  return node instanceof Element && node.classList.contains('extent');\n}\n\ndocument.addEventListener('selectionchange', (ev) => {\n  const s = window.getSelection();\n  const {anchorNode: a, focusNode: b} = s;\n  if (a !== b && isExtentNode(a) && isExtentNode(b)) {\n    s.removeAllRanges();  // remove immediately to prevent flash\n    typer.focus();\n    typer.dispatchEvent(new CustomEvent('select-all'));\n  }\n}, true);\n\ndocument.addEventListener('focusin', (ev) => {\n  promises.microtask().then(() => {\n    if (document.activeElement === document.body) {\n      typer.focus();\n    }\n  });\n});\n\n// set minHeight to actual viewport height, but allow for keyboard etc\nconst resize = (ev) => {\n  const height = window.innerHeight;\n  document.body.style.minHeight = `${height}px`;\n};\nwindow.addEventListener('resize', resize);\nwindow.addEventListener('load', resize);\nresize();\n\n// Link tracking\n\ndocument.body.addEventListener('click', (ev) => {\n  const target = ev.target && ev.target.closest('a[href]');\n  if (!target) { return; }\n\n  ga('send', 'event', 'outbound', 'click', target.href);\n});\n\n// install code, delay by ~2500ms on load\n\nwindow.setTimeout(() => {\n  const dismissKey = 'dismiss-install';\n  const sourceKey = 'sources';\n  const sources = (window.localStorage[sourceKey] || '').split(',').filter(Boolean);\n\n  const sourceMatch = /utm_source=([_\\w\\d]*)/;\n  const m = sourceMatch.exec(window.location.search);\n  if (m) {\n    if (sources.indexOf(m[1]) === -1) {\n      sources.push(m[1]);\n    }\n    window.localStorage[sourceKey] = sources.join(',');\n  }\n\n  if (sources.length || window.localStorage[dismissKey]) {\n    return;  // we have been installed somewhere already\n  }\n\n  const footer = document.querySelector('footer');\n  footer.addEventListener('click', (ev) => {\n    if (!ev.target.classList.contains('dismiss-install')) {\n      return;\n    }\n    ga('send', 'event', 'install', 'dismiss');\n    window.localStorage[dismissKey] = true;\n    document.body.removeAttribute('data-install');\n  });\n\n  // TODO(samthor): Allow showing both ext/windows on say, Chrome Windows.\n  if (document.body.dataset['install']) {\n    // we probably got pipped to the post by PWA install, great\n  } else if (navigator.userAgent.match(/Chrome\\//) && navigator.platform.match(/^(Mac|Win|Linux)/)) {\n    // We're Chrome on some kind of desktop\n    document.body.dataset['install'] = 'ext';\n  } else if (typeof Windows === 'undefined' && navigator.platform.startsWith('Win')) {\n    // 'Windows' not found (not already installed), and on Windows\n    document.body.dataset['install'] = 'windows';\n  }\n\n}, 2500);\n\n// PWA install code below, run immediately\n\n(function() {\n\n  let deferredPrompt = null;\n\n  function cleanupPrompt() {\n    document.body.removeAttribute('data-install');\n    deferredPrompt = null;\n  }\n\n  window.addEventListener('beforeinstallprompt', (ev) => {\n    ga('send', 'event', 'install', 'available');\n    document.body.dataset['install'] = 'pwa';\n    deferredPrompt = ev;\n    ev.preventDefault();\n    return false;\n  });\n\n  window.addEventListener('appinstalled', (ev) => {\n    ga('send', 'event', 'install', 'installed');\n    cleanupPrompt();\n  });\n\n  const installEl = document.getElementById('install');\n  installEl.addEventListener('click', (ev) => {\n    if (!deferredPrompt) {\n      return;\n    }\n    deferredPrompt.prompt();\n\n    if (!deferredPrompt.userChoice) {\n      return;  // older Chrome\n    }\n\n    deferredPrompt.userChoice.then((result) => {\n      ga('send', 'event', 'install', result);\n      // TODO: should we listen to appinstalled? I suppose we don't know what the user said.\n    }).catch((err) => {\n      console.warn('beforeinstallprompt prompt', err);\n    }).then(cleanupPrompt);\n  });\n\n}());\n","\n/**\n * @fileoverview Rotates through various advertisements in Emojityper.\n */\n\nconst adverts = document.getElementById('adverts');\n\nfunction refresh() {\n  const active = adverts.querySelector('.active');\n  const next = (active && active.nextElementSibling || adverts.firstElementChild);\n  if (!next) {\n    console.warn('no adverts to choose from');\n    return;\n  }\n\n  active && active.classList.remove('active');\n  next.classList.add('active');\n\n  enqueue();\n}\n\nlet timeout;\nfunction enqueue() {\n  window.clearTimeout(timeout);\n  timeout = window.setTimeout(() => {\n    window.requestAnimationFrame(refresh);\n  }, 10 * 1000);\n}\n\nenqueue();\n","\nif (navigator.serviceWorker) {\n  navigator.serviceWorker.register('./sw.js').catch((err) => {\n    console.warn('failed to register SW', err);\n  });\n\n  const hadInitialController = Boolean(navigator.serviceWorker.controller);\n  navigator.serviceWorker.addEventListener('controllerchange', () => {\n    if (hadInitialController) {\n      // only reload if we had a SW on load\n      console.debug('got SW controllerchange, reload');\n      window.location.reload();\n    } else {\n      // this is the very first SW, so reloading doesn't help us\n    }\n  });\n}\n","\nimport {debounce} from './lib/promises.js';\n\nlet prevOnLine = true;\n\nfunction notifyStatus() {\n  if ('onLine' in navigator && prevOnLine !== navigator.onLine) {\n    ga('send', 'event', 'network', navigator.onLine ? 'online' : 'offline');\n    prevOnLine = navigator.onLine;\n  }\n}\n\nnotifyStatus();\nwindow.addEventListener('online', () => debounce(notifyStatus));\nwindow.addEventListener('offline', () => debounce(notifyStatus));\n","\nconst placeholders = [\n  'Type words, receive emoji ',\n  'Use your keyboard to search ',\n  'Find emoji that your heart desires ',\n  'Keyboard. Emoji. Forever ',\n  'Keyboard emoji since 2016 ',\n  'Just tap a key to search ',\n  'Type, tap enter to copy, profit ',\n  'Emoji for every occasion, just type ',\n];\n\nconst choice = Math.floor(Math.random() * placeholders.length);\ntyper.placeholder = placeholders[choice];\n","\nimport './polyfill.js';\nimport './buttons.js';\nimport './input.js';\nimport './options.js';\nimport './selection.js';\nimport './page.js';\nimport './adverts.js';\nimport './sw.js';\nimport './offline.js';\nimport './placeholders.js';\n\n// global error handler for logs\nwindow.onerror = (msg, file, line, col, error) => {\n  console.info('got err', String(msg));\n  try {\n    ga('send', 'event', 'error', `${file},${line}:${col}`, String(msg), {nonInteraction: true});\n  } catch (e) {}\n};\n\n\n// add stuff after load\n\nwindow.addEventListener('load', (ev) => {\n  window.requestAnimationFrame(() => {\n    const scriptPWACompat = document.createElement('script');\n    document.head.appendChild(scriptPWACompat);\n    scriptPWACompat.outerHTML = `\n<script\nasync\nsrc=\"https://cdn.jsdelivr.net/npm/pwacompat@2.0.7/pwacompat.min.js\"\nintegrity=\"sha384-ptgwb3/v69WGur7IwSnWOowVxE7hcRB3DG/EiHdejrw2sFNwUHynFbiRMPxc4hdS\"\ncrossorigin=\"anonymous\">\n</script>`;\n\n    if (window._dev) {\n      return;  // don't analytics in dev\n    }\n\n    const scriptAnalytics = document.createElement('script');\n    scriptAnalytics.src = 'https://www.google-analytics.com/analytics.js';\n    scriptAnalytics.async = true;\n    document.head.appendChild(scriptAnalytics);\n  });\n});\n\n\nwindow['GoogleAnalyticsObject'] = 'ga';\n\nconst prep = function() {\n  prep['q'].push(arguments);\n};\nprep['q'] = [];\nprep['l'] = 1 * new Date;\nwindow['ga'] = prep;\n\nnavigator.sendBeacon && ga('set', 'transport', 'beacon');\nga('create', 'UA-39885839-6', 'auto');\nga('send', 'pageview');"],"names":["window","location","search","indexOf","Map","WeakMap","$export","require","toLength","context","$startsWith","P","F","startsWith","searchString","that","this","index","Math","min","arguments","length","undefined","String","call","slice","toAbsoluteIndex","fromCharCode","$fromCodePoint","fromCodePoint","S","x","code","res","aLen","i","RangeError","push","join","ctx","toObject","isArrayIter","createProperty","getIterFn","iter","from","arrayLike","result","step","iterator","O","C","Array","mapfn","mapping","iterFn","next","done","value","Internal","newGenericPromiseCapability","OwnPromiseCapability","Wrapper","LIBRARY","global","classof","isObject","aFunction","anInstance","forOf","speciesConstructor","task","set","microtask","newPromiseCapabilityModule","perform","userAgent","promiseResolve","TypeError","process","versions","v8","$Promise","isNode","empty","newPromiseCapability","f","USE_NATIVE","promise","resolve","FakePromise","constructor","exec","PromiseRejectionEvent","then","e","isThenable","it","notify","isReject","_n","chain","_c","_v","ok","_s","run","reaction","exited","handler","fail","reject","domain","_h","onHandleUnhandled","enter","exit","onUnhandled","console","unhandled","isUnhandled","emit","onunhandledrejection","reason","error","_a","v","onrejectionhandled","$reject","_d","_w","$resolve","wrapper","executor","err","prototype","onFulfilled","onRejected","catch","G","W","Promise","r","capability","$$reject","all","iterable","values","remaining","$index","alreadyCalled","race","has","DESCRIPTORS","redefine","META","KEY","$fails","shared","setToStringTag","uid","wks","wksExt","wksDefine","enumKeys","isArray","anObject","toIObject","toPrimitive","createDesc","_create","gOPNExt","$GOPD","$DP","$keys","gOPD","dP","gOPN","$Symbol","Symbol","$JSON","JSON","_stringify","stringify","HIDDEN","TO_PRIMITIVE","isEnum","propertyIsEnumerable","SymbolRegistry","AllSymbols","OPSymbols","ObjectProto","Object","QObject","setter","findChild","setSymbolDesc","get","a","key","D","protoDesc","wrap","tag","sym","_k","isSymbol","_typeof","$defineProperty","enumerable","$defineProperties","keys","l","$propertyIsEnumerable","E","$getOwnPropertyDescriptor","$getOwnPropertyNames","names","$getOwnPropertySymbols","IS_OP","configurable","$set","name","es6Symbols","split","j","wellKnownSymbols","store","k","for","keyFor","useSetter","useSimple","create","defineProperty","defineProperties","getOwnPropertyDescriptor","getOwnPropertyNames","getOwnPropertySymbols","replacer","$replacer","args","apply","valueOf","Op","hasOwn","hasOwnProperty","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","inModule","module","runtime","regeneratorRuntime","exports","GenStateSuspendedStart","GenStateSuspendedYield","GenStateExecuting","GenStateCompleted","ContinueSentinel","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","GeneratorFunctionPrototype","Generator","GeneratorFunction","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","arg","__await","defineIteratorMethods","AsyncIterator","async","innerFn","outerFn","self","tryLocsList","toString","object","reverse","pop","Context","reset","skipTempReset","prev","sent","_sent","delegate","method","tryEntries","forEach","resetTryEntry","charAt","isNaN","stop","rootRecord","completion","type","rval","dispatchException","exception","handle","loc","caught","record","entry","tryLoc","hasCatch","hasFinally","catchLoc","finallyLoc","Error","abrupt","finallyEntry","complete","afterLoc","finish","thrown","delegateYield","resultName","nextLoc","protoGenerator","generator","_invoke","state","doneResult","delegateResult","maybeInvokeDelegate","tryCatch","makeInvokeMethod","fn","obj","previousPromise","callInvokeWithMethodAndArg","invoke","unwrapped","return","info","pushTryEntry","locs","iteratorMethod","Function","CustomEvent","params","bubbles","cancelable","detail","event","document","createEvent","initCustomEvent","Event","Element","writable","parentNode","removeChild","testEl","createElement","classList","toggle","contains","original","DOMTokenList","force","add","remove","matches","msMatchesSelector","webkitMatchesSelector","closest","s","el","documentElement","parentElement","nodeType","fetch","requestIdleCallback","callback","start","performance","now","bind","didTimeout","timeRemaining","max","setTimeout","cancelIdleCallback","id","clearTimeout","navigator","sendBeacon","url","body","xhr","XMLHttpRequest","open","onerror","onload","send","dummy","arrowKeys","isKeyboardClick","ev","MouseEvent","screenX","webkitForce","copyText","text","style","position","opacity","appendChild","hidden","focus","selectionStart","selectionEnd","execCommand","input","querySelectorAll","trim","hasValue","Boolean","button","disabled","typer","addEventListener","jsdecode","len","points","raw","charCodeAt","extra","timeout","defaultText","textContent","copy","dataset","replace","copier","warn","ga","maybeReleaseInputEnter","parent","postMessage","wasInputEnter","activeElement","repeat","click","preventDefault","eventlib","iterateEmoji","_iterateEmoji","runeZWJ","runeVS16","isSkinTone","p","isFlagPoint","isTag","skippable","_emojiPointCount","halfCount","pending","curr","flag","ensure","off","cand","shift","tail","fixedWidthEmoji","platform","needsManWomanHack","letterSpacing","fontSize","hider","overflow","width","setAttribute","measurer","measure","getBoundingClientRect","offsetWidth","height","offsetHeight","display","whiteSpace","lineHeight","fontFamily","invalidBoxSize","validEmojiSize","fixedWidthMeasure","getContext","font","expectedWidth","measureText","countExtraAllowed","isSingleValidEmoji","rect","expected","round","isExpectedLength","actual","emojiPointCount","countRenderPoints","part","reverseParts","isSingle","limit","cache","count","cacheFor","basicDiversity","skipDiversityList","skipDiversity","isFamilyMember","genderFlip","list","data","m","n","point","out","single","neutral","last","lastIndexOf","emoji","to","trailer","modify","op","stats","tone","gender","double","outer","genderable","familyLike","first","localFamilyMember","localPersonGender","flip","valid","splice","update","filter","map","splitPoints","parts","localOp","foundAny","merged","letterAt","pos","datasetSafeDelete","d","upgraded","rAF","delay","requestAnimationFrame","sel","helper","className","insertBefore","underline","suggest","autocomplete","sizer","nonce","offsetLeft","mid","substr","scrollLeft","readyState","renderLine","permitNextChange","frame","events","dedup","left","getElementById","transform","setRange","initialLength","end","changeHandler","dispatchEvent","at","word","toLowerCase","previousDetail","heldScrollLeft","mergedEventHandler","setSelectionRange","alreadyAtState","renderAutocomplete","prefix","selection","hasPendingSpace","maybeReplace","expectSpace","rest","mustBeSpace","choice","Set","clear","passive","which","success","shiftKey","keyCode","dedupRenderLine","replaceFocus","previousScrollLeft","dir","selectionDirection","drift","where","modifier","upgrade","debouceMap","debounce","callable","c","delete","t","merge","lookup","existing","row","existingRow","updatedData","found","item","removeDuplicates","concat","options","abcd","abc","ab","atm","cool","free","o","sos","up","vs","!!","!?","!","?","$","","","","new","ng","zzz","1234","cl","b","wc","100","10","*","#","<",">","^","+","-","~",".","sort","matchPrefix","preferLetter","codePointAt","work","matched","api","loaderFor","promiseResults","expiry","localStorage","parse","debug","Date","responseType","response","loader","getPrefixGen","working","results","prefixLength","maxSuggestions","prefixSuggest","opts","typed","build","getTrendingEmoji","request","more","recent","unshift","encodeURIComponent","morePromise","json","typerLetter","select","runner","promises","Worker","fn_","queue_","waiting_","runner_","_this","chunk_","_this2","dummyString","ls","known","ignoreValid","worker","immediate","calledWithDelay","_context2","ButtonManager","holder","holder_","options_","buttons_","buttonTarget_","buttonPool_","modifierHolder","setModifier","genderOption","optionType_","toneOption","createModifierButton","genders","tones","updateStatus","yes","node","owner","active","nextSibling","option","target","isValid","replaceChild","createTextNode","buttons","previousActiveElement","special","_this3","optionForName_","children","addEmojiTo_","spaceFrame","chooser","localName","previousChooserLeft","duringNavigate","navigateChooserButtonVertical","cands","best","dist","Infinity","previousRect","targetTop","candidateRect","top","abs","isKeyboard","label","scrollTop","scrollingElement","metaKey","ctrlKey","provider","typerRect","querySelector","arrow","delta","buttonArray","focusRect","innerHeight","manager","previous","previousQueryAt","previousResults","suggestInvoke","findSuggest","q","localSuggestInvoke","exactMatch","localResults","findValidMatch","query","initialMore","pow","advanced","form","namer","FormData","append","mode","status","_","ms","isExtentNode","getSelection","anchorNode","focusNode","removeAllRanges","resize","minHeight","href","sources","removeAttribute","match","Windows","deferredPrompt","cleanupPrompt","prompt","userChoice","adverts","refresh","nextElementSibling","firstElementChild","enqueue","serviceWorker","register","hadInitialController","controller","reload","prevOnLine","notifyStatus","onLine","placeholders","floor","random","placeholder","msg","file","line","col","nonInteraction","scriptPWACompat","head","outerHTML","_dev","scriptAnalytics","src","prep"],"mappings":"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"}